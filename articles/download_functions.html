<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>download_data • amadeus</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="download_data">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">amadeus</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/download_functions.html">download_data</a></li>
    <li><a class="dropdown-item" href="../articles/epa_download.html">Downloading EPA Daily Data</a></li>
    <li><a class="dropdown-item" href="../articles/protected_datasets.html">Protected Data Sources</a></li>
  </ul>
</li>
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/NIEHS/amadeus/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>download_data</h1>
                        <h4 data-toc-skip class="author">Mitchell
Manware</h4>
            
            <h4 data-toc-skip class="date">2024-07-09</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/NIEHS/amadeus/blob/main/vignettes/download_functions.Rmd" class="external-link"><code>vignettes/download_functions.Rmd</code></a></small>
      <div class="d-none name"><code>download_functions.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="motivation">Motivation<a class="anchor" aria-label="anchor" href="#motivation"></a>
</h2>
<p>The <code>download_data</code> function was developed to improve
researchers’ access to publicly available environmental data. Although
the data are already available online, using a web browser to manually
download hundreds or thousands of data files is slow, arduous, and not
efficiently repeatable. Additionally, as users may not be familiar with
creating download recipes in Bash (Unix shell),
<code>download_data</code> allows researchers to download data directly
with <code>R</code>, a common coding language in the field of
environmental health research. Finally, function-izing data downloads is
useful for repeated code or automated analysis pipelines.</p>
</div>
<div class="section level2">
<h2 id="download_data">download_data<a class="anchor" aria-label="anchor" href="#download_data"></a>
</h2>
<p><code>download_data</code> is acccesses and downloads environmental
datasets, collections, and variables from a variety of sources. This
wrapper function calls source-specific data download functions, each
utilizing a unique combination of input parameters, host URL, naming
convention, and data formats.</p>
<table class="table">
<caption>Source-specific download functions and data sources</caption>
<colgroup>
<col width="2%">
<col width="21%">
<col width="75%">
</colgroup>
<thead><tr class="header">
<th align="left"></th>
<th align="left">Download Function</th>
<th align="left">Data Source</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">14</td>
<td align="left">download_gridmet</td>
<td align="left"><a href="https://www.climatologylab.org/gridmet.html" class="external-link">Climatology Lab
GridMet</a></td>
</tr>
<tr class="even">
<td align="left">13</td>
<td align="left">download_terraclimate</td>
<td align="left"><a href="https://www.climatologylab.org/terraclimate.html" class="external-link">Climatology Lab
TerraClimate</a></td>
</tr>
<tr class="odd">
<td align="left">5</td>
<td align="left">download_koppen_geiger</td>
<td align="left"><a href="https://www.nature.com/articles/sdata2018214" class="external-link">Köppen-Geiger
Climate Classification (Beck et al., 2018)</a></td>
</tr>
<tr class="even">
<td align="left">8</td>
<td align="left">download_nlcd</td>
<td align="left"><a href="https://www.mrlc.gov/data" class="external-link">MRLC Consortium
National Land Cover Database (NLCD)</a></td>
</tr>
<tr class="odd">
<td align="left">3</td>
<td align="left">download_geos_data</td>
<td align="left"><a href="https://gmao.gsfc.nasa.gov/GEOS_systems/" class="external-link">NASA
Goddard Earth Observing System Composition Forecasting
(GEOS-CF)</a></td>
</tr>
<tr class="even">
<td align="left">12</td>
<td align="left">download_modis</td>
<td align="left"><a href="https://modis.gsfc.nasa.gov/data/" class="external-link">NASA
Moderate Resolution Imaging Spectroradiometer (MODIS)</a></td>
</tr>
<tr class="odd">
<td align="left">6</td>
<td align="left">download_merra2</td>
<td align="left"><a href="https://gmao.gsfc.nasa.gov/reanalysis/MERRA-2/" class="external-link">NASA Modern-Era
Retrospective analysis for Research and Applications, Version 2
(MERRA-2)</a></td>
</tr>
<tr class="even">
<td align="left">10</td>
<td align="left">download_sedac_groads</td>
<td align="left"><a href="https://sedac.ciesin.columbia.edu/data/set/groads-global-roads-open-access-v1/data-download" class="external-link">NASA
SEDAC Global Roads Open Access Data Set</a></td>
</tr>
<tr class="odd">
<td align="left">11</td>
<td align="left">download_sedac_population</td>
<td align="left"><a href="https://sedac.ciesin.columbia.edu/data/set/gpw-v4-population-density-adjusted-to-2015-unwpp-country-totals-rev11" class="external-link">NASA
SEDAC UN WPP-Adjusted Population Density</a></td>
</tr>
<tr class="even">
<td align="left">9</td>
<td align="left">download_hms</td>
<td align="left"><a href="https://www.ospo.noaa.gov/Products/land/hms.html#0" class="external-link">NOAA Hazard
Mapping System Fire and Smoke Product</a></td>
</tr>
<tr class="odd">
<td align="left">7</td>
<td align="left">download_narr</td>
<td align="left"><a href="https://psl.noaa.gov/data/gridded/data.narr.html" class="external-link">NOAA NCEP North
American Regional Reanalysis (NARR)</a></td>
</tr>
<tr class="even">
<td align="left">15</td>
<td align="left">download_osm</td>
<td align="left"><a href="https://opengeohub.org/about-openlandmap/" class="external-link">OpenGeoHub Foundation
OpenLandMap</a></td>
</tr>
<tr class="odd">
<td align="left">16</td>
<td align="left">download_prism</td>
<td align="left"><a href="https://elibrary.asabe.org/abstract.asp??JID=3&amp;AID=3101&amp;CID=t2000&amp;v=43&amp;i=6&amp;T=1" class="external-link">Parameter
Elevation Regression on Independent Slopes Model (PRISM)</a></td>
</tr>
<tr class="even">
<td align="left">1</td>
<td align="left">download_aqs</td>
<td align="left"><a href="https://aqs.epa.gov/aqsweb/airdata/download_files.html" class="external-link">US EPA Air
Data Pre-Generated Data Files</a></td>
</tr>
<tr class="odd">
<td align="left">2</td>
<td align="left">download_ecoregion</td>
<td align="left"><a href="https://www.epa.gov/eco-research/ecoregions" class="external-link">US EPA
Ecoregions</a></td>
</tr>
<tr class="even">
<td align="left">17</td>
<td align="left">download_nei</td>
<td align="left"><a href="https://www.epa.gov/air-emissions-inventories" class="external-link">US EPA National
Emissions Inventory (NEI)</a></td>
</tr>
<tr class="odd">
<td align="left">18</td>
<td align="left">download_tri</td>
<td align="left"><a href="https://www.epa.gov/toxics-release-inventory-tri-program/tri-basic-data-files-calendar-years-1987-present" class="external-link">US
EPA Toxic Release Inventory (TRI) Program</a></td>
</tr>
<tr class="even">
<td align="left">4</td>
<td align="left">download_gmted</td>
<td align="left"><a href="https://www.usgs.gov/coastal-changes-and-impacts/gmted2010" class="external-link">USGS
Global Multi-resolution Terrain Elevation Data (GMTED2010)</a></td>
</tr>
<tr class="odd">
<td align="left">19</td>
<td align="left">download_huc</td>
<td align="left"><a href="https://www.sciencebase.gov/catalog/item/4f5545cce4b018de15819ca9" class="external-link">USGS
National Hydrography Dataset (NHD)</a></td>
</tr>
</tbody>
</table>
<p>It is important to note that <code>download_data</code> calls a
source-specific function based on the <code>dataset_name</code>
parameter. Using the source-specific function directly will return the
same data <strong>if the parameters are the same</strong>, but the error
messages produced by each differ slightly.</p>
<div class="section level3">
<h3 id="parameters">Parameters<a class="anchor" aria-label="anchor" href="#parameters"></a>
</h3>
<p>User-defined parameters differ based on the data source. Required
parameters for each source can be checked with
<code>names(formals())</code>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/formals.html" class="external-link">formals</a></span><span class="op">(</span><span class="va">download_hms</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "data_format"       "date"              "directory_to_save"</span></span>
<span><span class="co">## [4] "acknowledgement"   "download"          "remove_command"   </span></span>
<span><span class="co">## [7] "unzip"             "remove_zip"</span></span></code></pre>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/formals.html" class="external-link">formals</a></span><span class="op">(</span><span class="va">download_narr</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "variables"         "year"              "directory_to_save"</span></span>
<span><span class="co">## [4] "acknowledgement"   "download"          "remove_command"</span></span></code></pre>
<p>The two functions have different required parameters because
<code>download_hms</code> uses a daily temporal resolution while
<code>download_narr</code> uses yearly, but they share some common,
standard parameters.</p>
<div class="section level4">
<h4 id="standard-parameters">Standard parameters<a class="anchor" aria-label="anchor" href="#standard-parameters"></a>
</h4>
<p>Four parameters are included in all of the data download
functions.</p>
<table class="table">
<colgroup>
<col width="9%">
<col width="5%">
<col width="85%">
</colgroup>
<thead><tr class="header">
<th align="left">Parameter</th>
<th align="left">Type</th>
<th align="left">Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">directory_to_save</td>
<td align="left">Character</td>
<td align="left">There must be a directory to save downloaded data.
Default = ‘./input/DATASET_NAME/’.</td>
</tr>
<tr class="even">
<td align="left">acknowledgement</td>
<td align="left">Logical</td>
<td align="left">User must acknowledge that downloading geospatial data
can be very lage and may use lots of machine storage and memory.</td>
</tr>
<tr class="odd">
<td align="left">download</td>
<td align="left">Logical</td>
<td align="left">Run or skip the data download. Utilized primarily for
unit tests (see <a href="#unit-tests">Unit Tests</a>).</td>
</tr>
<tr class="even">
<td align="left">remove_command</td>
<td align="left">Logical</td>
<td align="left">Remove or retain the text file containing the generated
download commands. Utilized primarily for unit tests (see <a href="#unit-tests">Unit Tests</a> and <a href="#initiate-commands.txt">4. Initiate “…commands.txt”</a>).</td>
</tr>
</tbody>
</table>
<p>Additionally, the <code>dataset_name</code> parameter must be
specified when using <code>download_data</code>, but is assumed when
using a source-specific download function.</p>
</div>
</div>
<div class="section level3">
<h3 id="function-structure">Function Structure<a class="anchor" aria-label="anchor" href="#function-structure"></a>
</h3>
<p>Although each source-specific download function is unique, they all
follow the same general structure. The following chunks of code have
been adopted from <code>download_hms</code> to demonstrate the
functions’ structure.</p>
<p><a href="#clean-parameters">1. Clean Parameters</a></p>
<p><a href="#generate-download-urls">2. Generate Download URLs</a></p>
<p><a href="#generate-download-file-names">3. Generate download file
names</a></p>
<p><a href="#initiate-commands.txt">4. Initiate “…commands.txt”</a></p>
<p><a href="#concatenate-download-commands">5. Concatenate download
commands</a></p>
<p><a href="#finalize-commands.txt">6. Finalize “…commands.txt”</a></p>
<p><a href="#run-commands-in-commands.txt">7. Run commands in
“…commands.txt”</a></p>
<p><a href="#zip-files-if-applicable">8. Zip files (if
applicable)</a></p>
<div class="section level4">
<h4 id="clean-parameters">1. Clean parameters<a class="anchor" aria-label="anchor" href="#clean-parameters"></a>
</h4>
<p>Cleaning the user-defined parameters is highly dependent on the
parameters themselves and the desired URL to be created. A common
parameter cleaning step is creating a date-time sequence based on a
given temporal range and required format, in this case
<code>YYYYMMDD</code>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># user defined parameters</span></span>
<span><span class="va">dates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2023-12-28"</span>, <span class="st">"2024-01-02"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">date_sequence</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="va">dates</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, format <span class="op">=</span> <span class="st">"%Y-%m-%d"</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="va">dates</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, format <span class="op">=</span> <span class="st">"%Y-%m-%d"</span><span class="op">)</span>,</span>
<span>  <span class="st">"day"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">date_sequence</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"-"</span>, <span class="st">""</span>, <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">date_sequence</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">date_sequence</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "20231228" "20231229" "20231230" "20231231" "20240101" "20240102"</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="generate-download-urls">2. Generate download URLs<a class="anchor" aria-label="anchor" href="#generate-download-urls"></a>
</h4>
<p>The URL base and pattern are identified by manually inspecting the
download link on the source-specific web page. <code>download_hms</code>
utilizes the year, month, date, and data format to generate the download
url.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># user defined parameters</span></span>
<span><span class="va">data_format</span> <span class="op">&lt;-</span> <span class="st">"Shapefile"</span></span>
<span><span class="va">suffix</span> <span class="op">&lt;-</span> <span class="st">".zip"</span></span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">urls</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">d</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">date_sequence</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">year</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span><span class="va">date_sequence</span><span class="op">[</span><span class="va">d</span><span class="op">]</span>, <span class="fl">1</span>, <span class="fl">4</span><span class="op">)</span></span>
<span>  <span class="va">month</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span><span class="va">date_sequence</span><span class="op">[</span><span class="va">d</span><span class="op">]</span>, <span class="fl">5</span>, <span class="fl">6</span><span class="op">)</span></span>
<span>  <span class="va">base</span> <span class="op">&lt;-</span> <span class="st">"https://satepsanone.nesdis.noaa.gov/pub/FIRE/web/HMS/Smoke_Polygons/"</span></span>
<span>  <span class="va">url</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span></span>
<span>    <span class="va">base</span>,</span>
<span>    <span class="va">data_format</span>,</span>
<span>    <span class="st">"/"</span>,</span>
<span>    <span class="va">year</span>,</span>
<span>    <span class="st">"/"</span>,</span>
<span>    <span class="va">month</span>,</span>
<span>    <span class="st">"/hms_smoke"</span>,</span>
<span>    <span class="va">date_sequence</span><span class="op">[</span><span class="va">d</span><span class="op">]</span>,</span>
<span>    <span class="va">suffix</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="va">urls</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">urls</span>, <span class="va">url</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">urls</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "https://satepsanone.nesdis.noaa.gov/pub/FIRE/web/HMS/Smoke_Polygons/Shapefile/2023/12/hms_smoke20231228.zip"</span></span>
<span><span class="co">## [2] "https://satepsanone.nesdis.noaa.gov/pub/FIRE/web/HMS/Smoke_Polygons/Shapefile/2023/12/hms_smoke20231229.zip"</span></span>
<span><span class="co">## [3] "https://satepsanone.nesdis.noaa.gov/pub/FIRE/web/HMS/Smoke_Polygons/Shapefile/2023/12/hms_smoke20231230.zip"</span></span>
<span><span class="co">## [4] "https://satepsanone.nesdis.noaa.gov/pub/FIRE/web/HMS/Smoke_Polygons/Shapefile/2023/12/hms_smoke20231231.zip"</span></span>
<span><span class="co">## [5] "https://satepsanone.nesdis.noaa.gov/pub/FIRE/web/HMS/Smoke_Polygons/Shapefile/2024/01/hms_smoke20240101.zip"</span></span>
<span><span class="co">## [6] "https://satepsanone.nesdis.noaa.gov/pub/FIRE/web/HMS/Smoke_Polygons/Shapefile/2024/01/hms_smoke20240102.zip"</span></span></code></pre>
<p>A download URL is created for each date in <code>date_sequence</code>
based on the fixed pattern.</p>
</div>
<div class="section level4">
<h4 id="generate-download-file-names">3. Generate download file names<a class="anchor" aria-label="anchor" href="#generate-download-file-names"></a>
</h4>
<p>The generation of download file names also follows a fixed pattern,
typically a combination of the user-defined download directory, dataset
name, spatiotemporal characteristic, data type, and, if applicable,
specific variable name. Unlike the download URLs, the download file
names can be defined in any way by the writer of the function, but using
the previously defined characteristics is useful for identification.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># user defined parameters</span></span>
<span><span class="va">directory_to_download</span> <span class="op">&lt;-</span> <span class="st">"./data/"</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">download_file_names</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">d</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">date_sequence</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">download_file_name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span></span>
<span>    <span class="va">directory_to_download</span>,</span>
<span>    <span class="st">"hms_smoke_"</span>,</span>
<span>    <span class="va">data_format</span>,</span>
<span>    <span class="st">"_"</span>,</span>
<span>    <span class="va">date_sequence</span><span class="op">[</span><span class="va">d</span><span class="op">]</span>,</span>
<span>    <span class="va">suffix</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="va">download_file_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">download_file_names</span>, <span class="va">download_file_name</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">download_file_names</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "./data/hms_smoke_Shapefile_20231228.zip"</span></span>
<span><span class="co">## [2] "./data/hms_smoke_Shapefile_20231229.zip"</span></span>
<span><span class="co">## [3] "./data/hms_smoke_Shapefile_20231230.zip"</span></span>
<span><span class="co">## [4] "./data/hms_smoke_Shapefile_20231231.zip"</span></span>
<span><span class="co">## [5] "./data/hms_smoke_Shapefile_20240101.zip"</span></span>
<span><span class="co">## [6] "./data/hms_smoke_Shapefile_20240102.zip"</span></span></code></pre>
<p>A download URL is created for each date in <code>date_sequence</code>
based on the fixed pattern.</p>
</div>
<div class="section level4">
<h4 id="initiate-commands-txt">4. Initiate “…commands.txt”<a class="anchor" aria-label="anchor" href="#initiate-commands-txt"></a>
</h4>
<p>An important aspect of the data download function is its
<code>sink...cat...sink</code> structure. Rather than using the
<code><a href="https://rdrr.io/r/utils/download.file.html" class="external-link">utils::download.file</a></code> function, a text file is created to
store all of the download commands generated from the URLs and file
names.</p>
<p>This structure is utilized for several reasons:</p>
<ul>
<li><p>Consistent structure for all the source-specific download
functions.</p></li>
<li><p>The <code>download.file</code> function cannot accept vectors of
URLs and destination files for downloading. An additional
<code>for</code> loop to download data will increase function complexity
and may reduce performance.</p></li>
<li><p>Writing commands in Bash (Unix shell) script allows for specific
arguments and flags.</p></li>
<li><p>Storing the download URLs without immediately running the
download allows for unit testing and URL checking (more on this in <a href="#unit-tests">Unit Tests</a>).</p></li>
</ul>
<p>The text file containing the download commands is named based on the
dataset, temporal range, and data transfer method.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">commands_txt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span></span>
<span>  <span class="va">directory_to_download</span>,</span>
<span>  <span class="st">"hms_smoke_"</span>,</span>
<span>  <span class="fu"><a href="https://rspatial.github.io/terra/reference/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="va">date_sequence</span>, n <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>  <span class="st">"_"</span>,</span>
<span>  <span class="fu"><a href="https://rspatial.github.io/terra/reference/headtail.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">date_sequence</span>, n <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>  <span class="st">"_curl_commands.txt"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Create and sink the text file.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/sink.html" class="external-link">sink</a></span><span class="op">(</span><span class="va">commands_txt</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="concatenate-download-commands">5. Concatenate download commands<a class="anchor" aria-label="anchor" href="#concatenate-download-commands"></a>
</h4>
<p>The Linux-based download commands are written according to the data
transfer method, download URL, download file name, and additional
arguments. Which additional arguments are included, and their order,
depend on the data transfer method and URL type.</p>
<p>For more information on <code>curl</code> and <code>wget</code>, the
two data transfer methods utilized by the data download functions, see
<a href="https://curl.se/docs/manpage.html" class="external-link">curl.1 the man page</a> and
<a href="https://www.gnu.org/software/wget/manual/wget.html" class="external-link">GNU Wget
1.21.1-dirty Manual</a> (latest version as of January 8, 2024).</p>
<p>The <code><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat()</a></code> function will store each of the download
commands written in the <code>for</code> loop to the previously sunk
commands text file (<code>commands_txt</code>).</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">for</span> <span class="op">(</span><span class="va">d</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">date_sequence</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">download_comamnd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span></span>
<span>    <span class="st">"curl -s -o "</span>,</span>
<span>    <span class="va">download_file_names</span><span class="op">[</span><span class="va">d</span><span class="op">]</span>,</span>
<span>    <span class="st">" --url "</span>,</span>
<span>    <span class="va">urls</span><span class="op">[</span><span class="va">d</span><span class="op">]</span>,</span>
<span>    <span class="st">"\n"</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="va">download_comamnd</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="finalize-commands-txt">6. Finalize “…commands.txt”<a class="anchor" aria-label="anchor" href="#finalize-commands-txt"></a>
</h4>
<p>After the download commands have been concatenated to the commands
text file, a second <code>sink</code> command is run to finalize the
file and stop the appending of R output.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/sink.html" class="external-link">sink</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="run-commands-in-commands-txt">7. Run commands in “…commands.txt”<a class="anchor" aria-label="anchor" href="#run-commands-in-commands-txt"></a>
</h4>
<p>A “system command” must be created to run all of the download
commands stored in the commands text file. In bash script,
<code>.</code> indicates to run all of the commands within a given
script. In this case, we will run all of the commands within the
commands text file.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">system_command</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span></span>
<span>  <span class="st">". "</span>,</span>
<span>  <span class="va">commands_txt</span>,</span>
<span>  <span class="st">"\n"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">system_command</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] ". ./data/hms_smoke_20231228_20240102_curl_commands.txt\n"</span></span></code></pre>
<p>Running the <code>system_command</code> deploys an “auxiliary”
function, <code>download_run</code>, a function created to reduce
repeated code across the source-specific download functions. The
function takes two parameters, <code>system_command</code>, which
indicates the command to be run, and <code>download</code>, a
user-defined logical parameter.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">download_run</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span></span>
<span>    <span class="va">download</span> <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    <span class="va">system_command</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">download</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Downloading requested files...\n"</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/system.html" class="external-link">system</a></span><span class="op">(</span>command <span class="op">=</span> <span class="va">system_command</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Requested files have been downloaded.\n"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Skipping data download.\n"</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>The data download is initiated by running <code>download_run</code>
with the system command identified and <code>download = TRUE</code>.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/download_run.html">download_run</a></span><span class="op">(</span></span>
<span>  download <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  system_command <span class="op">=</span> <span class="va">system_command</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Checking the download directory shows that all of the requested files
have been downloaded.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span>path <span class="op">=</span> <span class="va">directory_to_download</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "hms_smoke_Shapefile_20231228.zip" "hms_smoke_Shapefile_20231229.zip"</span></span>
<span><span class="co">## [3] "hms_smoke_Shapefile_20231230.zip" "hms_smoke_Shapefile_20231231.zip"</span></span>
<span><span class="co">## [5] "hms_smoke_Shapefile_20240101.zip" "hms_smoke_Shapefile_20240102.zip"</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="zip-files-if-applicable">8. Zip files (if applicable)<a class="anchor" aria-label="anchor" href="#zip-files-if-applicable"></a>
</h4>
<p>All of the source-specific data download functions follow this
general pattern, but those functions which download zip files require
additional steps to inflate and remove the downloaded zip files, if
desired. Each of these two steps are run by helper functions, and they
are run by the user-defined <code>unzip</code> and
<code>remove_zip</code> parameters in <code>download_data</code>.</p>
<p><code>download_unzip</code> inflates zip files if
<code>unzip = TRUE</code>, and skips inflation if
<code>unzip = FALSE</code>.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">download_unzip</span> <span class="op">&lt;-</span></span>
<span>  <span class="kw">function</span><span class="op">(</span><span class="va">file_name</span>,</span>
<span>           <span class="va">directory_to_unzip</span>,</span>
<span>           <span class="va">unzip</span> <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="va">unzip</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Downloaded files will not be unzipped.\n"</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Unzipping files...\n"</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/utils/unzip.html" class="external-link">unzip</a></span><span class="op">(</span><span class="va">file_name</span>,</span>
<span>      exdir <span class="op">=</span> <span class="va">directory_to_unzip</span></span>
<span>    <span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span></span>
<span>      <span class="st">"Files unzipped and saved in "</span>,</span>
<span>      <span class="va">directory_to_unzip</span>,</span>
<span>      <span class="st">".\n"</span></span>
<span>    <span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span></code></pre></div>
<p><code>download_remove_zips</code> removes the downloaded zip files if
<code>remove = TRUE</code>, and skips removal if
<code>remove = FALSE</code>.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">download_remove_zips</span> <span class="op">&lt;-</span></span>
<span>  <span class="kw">function</span><span class="op">(</span><span class="va">remove</span> <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>           <span class="va">download_name</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">remove</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Removing download files...\n"</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.remove</a></span><span class="op">(</span><span class="va">download_name</span><span class="op">)</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Download files removed.\n"</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span></code></pre></div>
<p>For this demonstration we will unzip (inflate) the downloaded zip
files but we will not delete them.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">for</span> <span class="op">(</span><span class="va">f</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">download_file_names</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/download_unzip.html">download_unzip</a></span><span class="op">(</span></span>
<span>    file_name <span class="op">=</span> <span class="va">download_file_names</span><span class="op">[</span><span class="va">f</span><span class="op">]</span>,</span>
<span>    directory_to_unzip <span class="op">=</span> <span class="va">directory_to_download</span>,</span>
<span>    unzip <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="../reference/download_remove_zips.html">download_remove_zips</a></span><span class="op">(</span></span>
<span>  download_name <span class="op">=</span> <span class="va">download_file_names</span>,</span>
<span>  remove <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Unzipping files...</span></span>
<span><span class="co">## Files unzipped and saved in ./data/.</span></span>
<span><span class="co">## Unzipping files...</span></span>
<span><span class="co">## Files unzipped and saved in ./data/.</span></span>
<span><span class="co">## Unzipping files...</span></span>
<span><span class="co">## Files unzipped and saved in ./data/.</span></span>
<span><span class="co">## Unzipping files...</span></span>
<span><span class="co">## Files unzipped and saved in ./data/.</span></span>
<span><span class="co">## Unzipping files...</span></span>
<span><span class="co">## Files unzipped and saved in ./data/.</span></span>
<span><span class="co">## Unzipping files...</span></span>
<span><span class="co">## Files unzipped and saved in ./data/.</span></span></code></pre>
<p>Listing the files again shows that the contents of the zip files have
been inflated and the zip files have been retained.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span>path <span class="op">=</span> <span class="va">directory_to_download</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] "hms_smoke_Shapefile_20231228.zip" "hms_smoke_Shapefile_20231229.zip"</span></span>
<span><span class="co">##  [3] "hms_smoke_Shapefile_20231230.zip" "hms_smoke_Shapefile_20231231.zip"</span></span>
<span><span class="co">##  [5] "hms_smoke_Shapefile_20240101.zip" "hms_smoke_Shapefile_20240102.zip"</span></span>
<span><span class="co">##  [7] "hms_smoke20231228.dbf"            "hms_smoke20231228.prj"           </span></span>
<span><span class="co">##  [9] "hms_smoke20231228.shp"            "hms_smoke20231228.shx"           </span></span>
<span><span class="co">## [11] "hms_smoke20231229.dbf"            "hms_smoke20231229.prj"           </span></span>
<span><span class="co">## [13] "hms_smoke20231229.shp"            "hms_smoke20231229.shx"           </span></span>
<span><span class="co">## [15] "hms_smoke20231230.dbf"            "hms_smoke20231230.prj"           </span></span>
<span><span class="co">## [17] "hms_smoke20231230.shp"            "hms_smoke20231230.shx"           </span></span>
<span><span class="co">## [19] "hms_smoke20231231.dbf"            "hms_smoke20231231.prj"           </span></span>
<span><span class="co">## [21] "hms_smoke20231231.shp"            "hms_smoke20231231.shx"           </span></span>
<span><span class="co">## [23] "hms_smoke20240101.dbf"            "hms_smoke20240101.prj"           </span></span>
<span><span class="co">## [25] "hms_smoke20240101.shp"            "hms_smoke20240101.shx"           </span></span>
<span><span class="co">## [27] "hms_smoke20240102.dbf"            "hms_smoke20240102.prj"           </span></span>
<span><span class="co">## [29] "hms_smoke20240102.shp"            "hms_smoke20240102.shx"</span></span></code></pre>
<p>The download function was structured successfully.</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="unit-tests">Unit Tests<a class="anchor" aria-label="anchor" href="#unit-tests"></a>
</h2>
<p>The previous outline successfully cleaned parameters, generated URLs,
and downloaded data, but how can we be sure that it will continue to
work with different temporal ranges and data types? To this end, unit
tests have been implemented to ensure that each data download function
runs properly and that URLs produced by <a href="#generate-download-urls">2. Generate download URLs</a> are valid
and accessible. Like the download functions, the unit tests rely on
“helper” functions to reduce repeated code across the tests.</p>
<div class="section level3">
<h3 id="helper-functions">Helper functions<a class="anchor" aria-label="anchor" href="#helper-functions"></a>
</h3>
<p><code>read_commands</code> imports the commands text file and
converts the data frame to a vector.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">read_commands</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span></span>
<span>    <span class="va">commands_path</span> <span class="op">=</span> <span class="va">commands_path</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">commands</span> <span class="op">&lt;-</span> <span class="fu">utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="va">commands_path</span>, header <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="va">commands</span> <span class="op">&lt;-</span> <span class="va">commands</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">commands</span><span class="op">)</span><span class="op">)</span>, <span class="op">]</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">commands</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><code>extract_urls</code> extracts each download URL from the vector
of commands. The <code>position</code> of the URL within the download
command is determined in <a href="#concatenate-download-commands">5.
Concatenate download commands</a>.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># function to extract URLs from vector</span></span>
<span><span class="va">extract_urls</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span></span>
<span>    <span class="va">commands</span> <span class="op">=</span> <span class="va">commands</span>,</span>
<span>    <span class="va">position</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">position</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"URL position in command is not defined.\n"</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">url_list</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">c</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">commands</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">url</span> <span class="op">&lt;-</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_split.html" class="external-link">str_split_i</a></span><span class="op">(</span><span class="va">commands</span><span class="op">[</span><span class="va">c</span><span class="op">]</span>, <span class="st">" "</span>, <span class="va">position</span><span class="op">)</span></span>
<span>    <span class="va">url_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">url_list</span>, <span class="va">url</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">url_list</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><code>check_url_status</code> is the most important of the download
test “helper” functions. This function utilizes <code><a href="https://httr.r-lib.org/reference/HEAD.html" class="external-link">httr::HEAD</a></code>
and <code><a href="https://httr.r-lib.org/reference/GET.html" class="external-link">httr::GET</a></code> to check the HTTP response status of a given
URL. The desired HTTP response status is 200, which means the URL is
valid and accessible. <code>check_url_status</code> returns a logical
value to indicate whether the URL returns HTTP status 200
(<code>TRUE</code>) or not (<code>FALSE</code>). For more information on
HTTP status’, see <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Status" class="external-link">HTTP
response status codes</a>.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">check_url_status</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span></span>
<span>    <span class="va">url</span>,</span>
<span>    <span class="va">method</span> <span class="op">=</span> <span class="st">"HEAD"</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">http_status_ok</span> <span class="op">&lt;-</span> <span class="fl">200</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">method</span> <span class="op">==</span> <span class="st">"HEAD"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">hd</span> <span class="op">&lt;-</span> <span class="fu">httr</span><span class="fu">::</span><span class="fu"><a href="https://httr.r-lib.org/reference/HEAD.html" class="external-link">HEAD</a></span><span class="op">(</span><span class="va">url</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">method</span> <span class="op">==</span> <span class="st">"GET"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">hd</span> <span class="op">&lt;-</span> <span class="fu">httr</span><span class="fu">::</span><span class="fu"><a href="https://httr.r-lib.org/reference/GET.html" class="external-link">GET</a></span><span class="op">(</span><span class="va">url</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">status</span> <span class="op">&lt;-</span> <span class="va">hd</span><span class="op">$</span><span class="va">status_code</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">status</span> <span class="op">==</span> <span class="va">http_status_ok</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><code>check_urls</code> applies <code>check_url_status</code> to a
random sample of URLs extracted by <code>extract_urls</code>. The sample
size will vary based on the dataset and spatio-temporal parameters being
tested. The function returns a logical vector containing the output from
<code>check_url_status</code>.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">check_urls</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span></span>
<span>    <span class="va">urls</span> <span class="op">=</span> <span class="va">urls</span>,</span>
<span>    <span class="va">size</span> <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    <span class="va">method</span> <span class="op">=</span> <span class="st">"HEAD"</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">size</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"URL sample size is not defined.\n"</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">urls</span><span class="op">)</span> <span class="op">&lt;</span> <span class="va">size</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">size</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">urls</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">url_sample</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">urls</span>, <span class="va">size</span>, replace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="va">url_status</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">url_sample</span>,</span>
<span>    <span class="va">check_url_status</span>,</span>
<span>    method <span class="op">=</span> <span class="va">method</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">url_status</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="testthat">testthat<a class="anchor" aria-label="anchor" href="#testthat"></a>
</h3>
<p>To demonstrate a test in action, test the URLs generated by
<code>download_data</code> for the NOAA HMS Smoke dataset.</p>
<p>For more information see <a href="https://testthat.r-lib.org/" class="external-link">testthat</a>.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://testthat.r-lib.org" class="external-link">testthat</a></span><span class="op">)</span></span>
<span><span class="fu">testthat</span><span class="fu">::</span><span class="fu"><a href="https://testthat.r-lib.org/reference/test_that.html" class="external-link">test_that</a></span><span class="op">(</span></span>
<span>  <span class="st">"Valid dates return HTTP response status = 200."</span>,</span>
<span>  <span class="op">{</span></span>
<span>    <span class="co"># parameters</span></span>
<span>    <span class="va">test_start</span> <span class="op">&lt;-</span> <span class="st">"2023-12-28"</span></span>
<span>    <span class="va">test_end</span> <span class="op">&lt;-</span> <span class="st">"2024-01-02"</span></span>
<span>    <span class="va">test_directory</span> <span class="op">&lt;-</span> <span class="st">"./data/"</span></span>
<span>    <span class="co"># download</span></span>
<span>    <span class="fu"><a href="../reference/download_data.html">download_data</a></span><span class="op">(</span></span>
<span>      dataset_name <span class="op">=</span> <span class="st">"hms"</span>,</span>
<span>      date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">test_start</span>, <span class="va">test_end</span><span class="op">)</span>,</span>
<span>      data_format <span class="op">=</span> <span class="st">"Shapefile"</span>,</span>
<span>      directory_to_save <span class="op">=</span> <span class="va">test_directory</span>,</span>
<span>      acknowledgement <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>      download <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>      remove_command <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>      unzip <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>      remove_zip <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>    <span class="op">)</span></span>
<span>    <span class="va">commands_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span></span>
<span>      <span class="va">test_directory</span>,</span>
<span>      <span class="st">"hms_smoke_"</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"-"</span>, <span class="st">""</span>, <span class="va">test_start</span><span class="op">)</span>,</span>
<span>      <span class="st">"_"</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"-"</span>, <span class="st">""</span>, <span class="va">test_end</span><span class="op">)</span>,</span>
<span>      <span class="st">"_curl_commands.txt"</span></span>
<span>    <span class="op">)</span></span>
<span>    <span class="co"># helpers</span></span>
<span>    <span class="va">commands</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_commands.html">read_commands</a></span><span class="op">(</span>commands_path <span class="op">=</span> <span class="va">commands_path</span><span class="op">)</span></span>
<span>    <span class="va">urls</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extract_urls.html">extract_urls</a></span><span class="op">(</span>commands <span class="op">=</span> <span class="va">commands</span>, position <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></span>
<span>    <span class="va">url_status</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/check_urls.html">check_urls</a></span><span class="op">(</span>urls <span class="op">=</span> <span class="va">urls</span>, size <span class="op">=</span> <span class="fl">6</span>, method <span class="op">=</span> <span class="st">"HEAD"</span><span class="op">)</span></span>
<span>    <span class="co"># test for true</span></span>
<span>    <span class="fu"><a href="https://testthat.r-lib.org/reference/logical-expectations.html" class="external-link">expect_true</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="va">url_status</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #00BB00;">Test passed</span> 🎊</span></span></code></pre>
<p>Although the <code>testthat::test_that(...)</code> chunk contains 32
lines of code, the unit test is performed by
<code>expect_true(all(url_status))</code>. In words, this line is
expecting (<code>expect_true</code>) that all (<code>all</code>) of the
sampled URLs return HTTP response status 200 (<code>url_status</code>).
Since this expectation was met, the test passed!</p>
<p>For an alternate example, we can use a start and end date that are
known to not have data. As the URLs associated with these dates do not
exist, we expect the function will fail. This test utilizes
<code><a href="https://testthat.r-lib.org/reference/expect_error.html" class="external-link">expect_error()</a></code> because the <code>download_data</code>
wrapper function returns an error message if the underlying
source-specific download function returns an error.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">testthat</span><span class="fu">::</span><span class="fu"><a href="https://testthat.r-lib.org/reference/test_that.html" class="external-link">test_that</a></span><span class="op">(</span></span>
<span>  <span class="st">"Invalid dates cause function to fail."</span>,</span>
<span>  <span class="op">{</span></span>
<span>    <span class="co"># parameters</span></span>
<span>    <span class="va">test_start</span> <span class="op">&lt;-</span> <span class="st">"1800-01-01"</span></span>
<span>    <span class="va">test_end</span> <span class="op">&lt;-</span> <span class="st">"1800-01-02"</span></span>
<span>    <span class="va">test_directory</span> <span class="op">&lt;-</span> <span class="st">"../inst/extdata/"</span></span>
<span>    <span class="co"># test for error</span></span>
<span>    <span class="fu">testthat</span><span class="fu">::</span><span class="fu"><a href="https://testthat.r-lib.org/reference/expect_error.html" class="external-link">expect_error</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="../reference/download_data.html">download_data</a></span><span class="op">(</span></span>
<span>        dataset_name <span class="op">=</span> <span class="st">"hms"</span>,</span>
<span>        date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">test_start</span>, <span class="va">test_end</span><span class="op">)</span>,</span>
<span>        data_format <span class="op">=</span> <span class="st">"Shapefile"</span>,</span>
<span>        directory_to_download <span class="op">=</span> <span class="va">test_directory</span>,</span>
<span>        directory_to_save <span class="op">=</span> <span class="va">test_directory</span>,</span>
<span>        acknowledgement <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>        download <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>        remove_command <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>        unzip <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>        remove_zip <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## &lt;simpleError in what_to_run(directory_to_save = directory_to_save, acknowledgement = acknowledgement,     ...): unused argument (directory_to_download = "../inst/extdata/")&gt;</span></span>
<span><span class="co">## function (data_format = "Shapefile", date = c("2018-01-01", "2018-01-01"), </span></span>
<span><span class="co">##     directory_to_save = NULL, acknowledgement = FALSE, download = FALSE, </span></span>
<span><span class="co">##     remove_command = FALSE, unzip = TRUE, remove_zip = FALSE) </span></span>
<span><span class="co">## NULL</span></span>
<span><span class="co">## <span style="color: #00BB00;">Test passed</span> 🎊</span></span></code></pre>
<p>This test utilizes <code><a href="https://testthat.r-lib.org/reference/expect_error.html" class="external-link">testthat::expect_error</a></code> because the
<code>download_data</code> wrapper function returns an error message if
the underlying source-specific download function returns an error. If we
directly used the <code>download_hms</code> function, we would expect
and receive an error.</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">testthat</span><span class="fu">::</span><span class="fu"><a href="https://testthat.r-lib.org/reference/test_that.html" class="external-link">test_that</a></span><span class="op">(</span></span>
<span>  <span class="st">"Invalid dates cause function to fail."</span>,</span>
<span>  <span class="op">{</span></span>
<span>    <span class="co"># parameters</span></span>
<span>    <span class="va">test_start</span> <span class="op">&lt;-</span> <span class="st">"1800-01-01"</span></span>
<span>    <span class="va">test_end</span> <span class="op">&lt;-</span> <span class="st">"1800-01-02"</span></span>
<span>    <span class="va">test_directory</span> <span class="op">&lt;-</span> <span class="st">"../inst/extdata/"</span></span>
<span>    <span class="co"># test for error</span></span>
<span>    <span class="fu">testthat</span><span class="fu">::</span><span class="fu"><a href="https://testthat.r-lib.org/reference/expect_error.html" class="external-link">expect_error</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="../reference/download_hms.html">download_hms</a></span><span class="op">(</span></span>
<span>        date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">test_start</span>, <span class="va">test_end</span><span class="op">)</span>,</span>
<span>        data_format <span class="op">=</span> <span class="st">"Shapefile"</span>,</span>
<span>        directory_to_download <span class="op">=</span> <span class="va">test_directory</span>,</span>
<span>        directory_to_save <span class="op">=</span> <span class="va">test_directory</span>,</span>
<span>        acknowledgement <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>        download <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>        remove_command <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>        unzip <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>        remove_zip <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #00BB00;">Test passed</span> 🌈</span></span></code></pre>
<p>As expected, the test passes because the NOAA HMS Smoke dataset does
not contain data for January 1-2, 1800.</p>
<p>These unit tests are just two of many implemented on
<code>download_data</code> and the accompanying source-specific download
functions, but they demonstrate how unit testing helps build stable
code.</p>
</div>
</div>
<div class="section level2">
<h2 id="download-example">Download Example<a class="anchor" aria-label="anchor" href="#download-example"></a>
</h2>
<p>With the function structure outlined and the unit tests in place, we
can now perform a data download. To begin, check the parameters required
by the source-specific data download function.</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/formals.html" class="external-link">formals</a></span><span class="op">(</span><span class="va">download_hms</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "data_format"       "date"              "directory_to_save"</span></span>
<span><span class="co">## [4] "acknowledgement"   "download"          "remove_command"   </span></span>
<span><span class="co">## [7] "unzip"             "remove_zip"</span></span></code></pre>
<p>Define the parameters.</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2023-12-28"</span>, <span class="st">"2024-01-02"</span><span class="op">)</span></span>
<span><span class="va">data_format</span> <span class="op">&lt;-</span> <span class="st">"Shapefile"</span></span>
<span><span class="va">data_directory</span> <span class="op">&lt;-</span> <span class="st">"./download_example/"</span></span>
<span><span class="va">acknowledgement</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span></span>
<span><span class="va">download</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span> <span class="co"># run data download</span></span>
<span><span class="va">remove_command</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span> <span class="co"># delete "...commands.txt" file</span></span>
<span><span class="va">unzip</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span> <span class="co"># inflate (unzip) downloaded zip files</span></span>
<span><span class="va">remove_zip</span> <span class="op">&lt;-</span> <span class="cn">FALSE</span> <span class="co"># retain downloaded zip files</span></span></code></pre></div>
<p>Download the data.</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/download_data.html">download_data</a></span><span class="op">(</span></span>
<span>  dataset_name <span class="op">=</span> <span class="st">"hms"</span>,</span>
<span>  date <span class="op">=</span> <span class="va">dates</span>,</span>
<span>  directory_to_save <span class="op">=</span> <span class="va">data_directory</span>,</span>
<span>  acknowledgement <span class="op">=</span> <span class="va">acknowledgement</span>,</span>
<span>  download <span class="op">=</span> <span class="va">download</span>,</span>
<span>  remove_command <span class="op">=</span> <span class="va">remove_command</span>,</span>
<span>  unzip <span class="op">=</span> <span class="va">unzip</span>,</span>
<span>  remove_zip <span class="op">=</span> <span class="va">remove_zip</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Downloading requested files...</span></span>
<span><span class="co">## Requested files have been downloaded.</span></span></code></pre>
<pre><code><span><span class="co">## Unzipping files...</span></span>
<span><span class="co">## Files unzipped and saved in ./download_example/.</span></span>
<span><span class="co">## Unzipping files...</span></span>
<span><span class="co">## Files unzipped and saved in ./download_example/.</span></span>
<span><span class="co">## Unzipping files...</span></span>
<span><span class="co">## Files unzipped and saved in ./download_example/.</span></span>
<span><span class="co">## Unzipping files...</span></span>
<span><span class="co">## Files unzipped and saved in ./download_example/.</span></span>
<span><span class="co">## Unzipping files...</span></span>
<span><span class="co">## Files unzipped and saved in ./download_example/.</span></span>
<span><span class="co">## Unzipping files...</span></span>
<span><span class="co">## Files unzipped and saved in ./download_example/.</span></span></code></pre>
<p>Checking the directory shows that all of our desired data has been
downloaded and inflated, and the original zip files have been
retained.</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">data_directory</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] "hms_smoke_Shapefile_20231228.zip" "hms_smoke_Shapefile_20231229.zip"</span></span>
<span><span class="co">##  [3] "hms_smoke_Shapefile_20231230.zip" "hms_smoke_Shapefile_20231231.zip"</span></span>
<span><span class="co">##  [5] "hms_smoke_Shapefile_20240101.zip" "hms_smoke_Shapefile_20240102.zip"</span></span>
<span><span class="co">##  [7] "hms_smoke20231228.dbf"            "hms_smoke20231228.prj"           </span></span>
<span><span class="co">##  [9] "hms_smoke20231228.shp"            "hms_smoke20231228.shx"           </span></span>
<span><span class="co">## [11] "hms_smoke20231229.dbf"            "hms_smoke20231229.prj"           </span></span>
<span><span class="co">## [13] "hms_smoke20231229.shp"            "hms_smoke20231229.shx"           </span></span>
<span><span class="co">## [15] "hms_smoke20231230.dbf"            "hms_smoke20231230.prj"           </span></span>
<span><span class="co">## [17] "hms_smoke20231230.shp"            "hms_smoke20231230.shx"           </span></span>
<span><span class="co">## [19] "hms_smoke20231231.dbf"            "hms_smoke20231231.prj"           </span></span>
<span><span class="co">## [21] "hms_smoke20231231.shp"            "hms_smoke20231231.shx"           </span></span>
<span><span class="co">## [23] "hms_smoke20240101.dbf"            "hms_smoke20240101.prj"           </span></span>
<span><span class="co">## [25] "hms_smoke20240101.shp"            "hms_smoke20240101.shx"           </span></span>
<span><span class="co">## [27] "hms_smoke20240102.dbf"            "hms_smoke20240102.prj"           </span></span>
<span><span class="co">## [29] "hms_smoke20240102.shp"            "hms_smoke20240102.shx"</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="download_hms-function-code">
<code>download_hms</code> function code<a class="anchor" aria-label="anchor" href="#download_hms-function-code"></a>
</h2>
<p>The following is the entire R code used to create
<code>download_hms</code>.</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">download_hms</span></span></code></pre></div>
<pre><code><span><span class="co">## function(</span></span>
<span><span class="co">##     data_format = "Shapefile",</span></span>
<span><span class="co">##     date = c("2018-01-01", "2018-01-01"),</span></span>
<span><span class="co">##     directory_to_save = NULL,</span></span>
<span><span class="co">##     acknowledgement = FALSE,</span></span>
<span><span class="co">##     download = FALSE,</span></span>
<span><span class="co">##     remove_command = FALSE,</span></span>
<span><span class="co">##     unzip = TRUE,</span></span>
<span><span class="co">##     remove_zip = FALSE) {</span></span>
<span><span class="co">##   #### 1. check for data download acknowledgement</span></span>
<span><span class="co">##   download_permit(acknowledgement = acknowledgement)</span></span>
<span><span class="co">##   #### 2. check for null parameters</span></span>
<span><span class="co">##   check_for_null_parameters(mget(ls()))</span></span>
<span><span class="co">##   #### check dates</span></span>
<span><span class="co">##   stopifnot(length(date) == 2)</span></span>
<span><span class="co">##   date &lt;- date[order(as.Date(date))]</span></span>
<span><span class="co">##   #### 3. directory setup</span></span>
<span><span class="co">##   directory_original &lt;- download_sanitize_path(directory_to_save)</span></span>
<span><span class="co">##   directories &lt;- download_setup_dir(directory_original, zip = TRUE)</span></span>
<span><span class="co">##   directory_to_download &lt;- directories[1]</span></span>
<span><span class="co">##   directory_to_save &lt;- directories[2]</span></span>
<span><span class="co">##   #### 4. check for unzip == FALSE &amp;&amp; remove_zip == TRUE</span></span>
<span><span class="co">##   if (unzip == FALSE &amp;&amp; remove_zip == TRUE) {</span></span>
<span><span class="co">##     stop(paste0(</span></span>
<span><span class="co">##       "Arguments unzip = FALSE and remove_zip = TRUE are not ",</span></span>
<span><span class="co">##       "acceptable together. Please change one.\n"</span></span>
<span><span class="co">##     ))</span></span>
<span><span class="co">##   }</span></span>
<span><span class="co">##   #### 5. define date sequence</span></span>
<span><span class="co">##   date_sequence &lt;- generate_date_sequence(</span></span>
<span><span class="co">##     date[1],</span></span>
<span><span class="co">##     date[2],</span></span>
<span><span class="co">##     sub_hyphen = TRUE</span></span>
<span><span class="co">##   )</span></span>
<span><span class="co">##   #### 6. define URL base</span></span>
<span><span class="co">##   base &lt;- "https://satepsanone.nesdis.noaa.gov/pub/FIRE/web/HMS/Smoke_Polygons/"</span></span>
<span><span class="co">##   #### 7. initiate "..._curl_commands.txt"</span></span>
<span><span class="co">##   commands_txt &lt;- paste0(</span></span>
<span><span class="co">##     directory_original,</span></span>
<span><span class="co">##     "hms_smoke_",</span></span>
<span><span class="co">##     utils::head(date_sequence, n = 1),</span></span>
<span><span class="co">##     "_",</span></span>
<span><span class="co">##     utils::tail(date_sequence, n = 1),</span></span>
<span><span class="co">##     "_curl_commands.txt"</span></span>
<span><span class="co">##   )</span></span>
<span><span class="co">##   download_sink(commands_txt)</span></span>
<span><span class="co">##   #### 8. concatenate and print download commands to "..._curl_commands.txt"</span></span>
<span><span class="co">##   download_names &lt;- NULL</span></span>
<span><span class="co">##   for (f in seq_along(date_sequence)) {</span></span>
<span><span class="co">##     year &lt;- substr(date_sequence[f], 1, 4)</span></span>
<span><span class="co">##     month &lt;- substr(date_sequence[f], 5, 6)</span></span>
<span><span class="co">##     if (tolower(data_format) == "shapefile") {</span></span>
<span><span class="co">##       data_format &lt;- "Shapefile"</span></span>
<span><span class="co">##       suffix &lt;- ".zip"</span></span>
<span><span class="co">##       directory_to_cat &lt;- directory_to_download</span></span>
<span><span class="co">##     } else if (tolower(data_format) == "kml") {</span></span>
<span><span class="co">##       data_format &lt;- "KML"</span></span>
<span><span class="co">##       suffix &lt;- ".kml"</span></span>
<span><span class="co">##       directory_to_cat &lt;- directory_to_save</span></span>
<span><span class="co">##     }</span></span>
<span><span class="co">##     url &lt;- paste0(</span></span>
<span><span class="co">##       base,</span></span>
<span><span class="co">##       data_format,</span></span>
<span><span class="co">##       "/",</span></span>
<span><span class="co">##       year,</span></span>
<span><span class="co">##       "/",</span></span>
<span><span class="co">##       month,</span></span>
<span><span class="co">##       "/hms_smoke",</span></span>
<span><span class="co">##       date_sequence[f],</span></span>
<span><span class="co">##       suffix</span></span>
<span><span class="co">##     )</span></span>
<span><span class="co">##     if (f == 1) {</span></span>
<span><span class="co">##       if (!(check_url_status(url))) {</span></span>
<span><span class="co">##         sink()</span></span>
<span><span class="co">##         file.remove(commands_txt)</span></span>
<span><span class="co">##         stop(paste0(</span></span>
<span><span class="co">##           "Invalid date returns HTTP code 404. ",</span></span>
<span><span class="co">##           "Check `date` parameter.\n"</span></span>
<span><span class="co">##         ))</span></span>
<span><span class="co">##       }</span></span>
<span><span class="co">##     }</span></span>
<span><span class="co">##     destfile &lt;- paste0(</span></span>
<span><span class="co">##       directory_to_cat,</span></span>
<span><span class="co">##       "hms_smoke_",</span></span>
<span><span class="co">##       data_format,</span></span>
<span><span class="co">##       "_",</span></span>
<span><span class="co">##       date_sequence[f],</span></span>
<span><span class="co">##       suffix</span></span>
<span><span class="co">##     )</span></span>
<span><span class="co">##     download_names &lt;- c(download_names, destfile)</span></span>
<span><span class="co">##     command &lt;- paste0(</span></span>
<span><span class="co">##       "curl -s -o ",</span></span>
<span><span class="co">##       destfile,</span></span>
<span><span class="co">##       " --url ",</span></span>
<span><span class="co">##       url,</span></span>
<span><span class="co">##       "\n"</span></span>
<span><span class="co">##     )</span></span>
<span><span class="co">##     if (!file.exists(destfile)) {</span></span>
<span><span class="co">##       #### cat command only if file does not already exist</span></span>
<span><span class="co">##       cat(command)</span></span>
<span><span class="co">##     }</span></span>
<span><span class="co">##   }</span></span>
<span><span class="co">##   #### 9. finish "..._curl_commands.txt"</span></span>
<span><span class="co">##   sink()</span></span>
<span><span class="co">##   #### 10. build system command</span></span>
<span><span class="co">##   system_command &lt;- paste0(</span></span>
<span><span class="co">##     ". ",</span></span>
<span><span class="co">##     commands_txt,</span></span>
<span><span class="co">##     "\n"</span></span>
<span><span class="co">##   )</span></span>
<span><span class="co">##   #### 11. download data</span></span>
<span><span class="co">##   download_run(</span></span>
<span><span class="co">##     download = download,</span></span>
<span><span class="co">##     system_command = system_command</span></span>
<span><span class="co">##   )</span></span>
<span><span class="co">##   #### 12. remove command file</span></span>
<span><span class="co">##   download_remove_command(</span></span>
<span><span class="co">##     remove = remove_command,</span></span>
<span><span class="co">##     commands_txt = commands_txt</span></span>
<span><span class="co">##   )</span></span>
<span><span class="co">##   #### 13. end if data_format == "KML"</span></span>
<span><span class="co">##   if (data_format == "KML") {</span></span>
<span><span class="co">##     unlink(directory_to_download, recursive = TRUE)</span></span>
<span><span class="co">##     message(paste0("KML files cannot be unzipped.\n"))</span></span>
<span><span class="co">##     return(TRUE)</span></span>
<span><span class="co">##   }</span></span>
<span><span class="co">##   #### 14. unzip downloaded zip files</span></span>
<span><span class="co">##   for (d in seq_along(download_names)) {</span></span>
<span><span class="co">##     download_unzip(</span></span>
<span><span class="co">##       file_name = download_names[d],</span></span>
<span><span class="co">##       directory_to_unzip = directory_to_save,</span></span>
<span><span class="co">##       unzip = unzip</span></span>
<span><span class="co">##     )</span></span>
<span><span class="co">##   }</span></span>
<span><span class="co">##   #### 15. remove zip files</span></span>
<span><span class="co">##   download_remove_zips(</span></span>
<span><span class="co">##     remove = remove_zip,</span></span>
<span><span class="co">##     download_name = download_names</span></span>
<span><span class="co">##   )</span></span>
<span><span class="co">## }</span></span>
<span><span class="co">## &lt;environment: namespace:amadeus&gt;</span></span></code></pre>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Mitchell Manware, Insang Song, Eva Marques, Mariana Alifa Kassien, Kyle Messier.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
