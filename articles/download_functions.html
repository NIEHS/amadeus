<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="amadeus">
<title>download_data() and NASA EarthData Account • amadeus</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="download_data() and NASA EarthData Account">
<meta property="og:description" content="amadeus">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">amadeus</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/download_functions.html">download_data() and NASA EarthData Account</a>
    <a class="dropdown-item" href="../articles/epa_download.html">Downloading EPA Daily Data</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/Spatiotemporal-Exposures-and-Toxicology/amadeus/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>download_data() and NASA EarthData Account</h1>
                        <h4 data-toc-skip class="author">Mitchell
Manware</h4>
            
            <h4 data-toc-skip class="date">2024-01-18</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/Spatiotemporal-Exposures-and-Toxicology/amadeus/blob/HEAD/vignettes/download_functions.Rmd" class="external-link"><code>vignettes/download_functions.Rmd</code></a></small>
      <div class="d-none name"><code>download_functions.Rmd</code></div>
    </div>

    
    
<pre><code><span><span class="co">##         ../R//download_support.R ../R//download_test_support.R ../R//download.R</span></span>
<span><span class="co">## value   ?                        ?                             ?               </span></span>
<span><span class="co">## visible FALSE                    FALSE                         FALSE</span></span></code></pre>
<div class="section level2">
<h2 id="motivation">Motivation<a class="anchor" aria-label="anchor" href="#motivation"></a>
</h2>
<p>The <code>data_download()</code> function was developed to improve
researchers’ access to publicly available geospatial data sets. Although
the data are already available online, using a web browser to manually
download hundreds or thousands of data files is slow, arduous, and not
(efficiently) repeatable. Additionally, as users may not be familiar
with creating download recipes in Bash (Unix shell),
<code>data_download()</code> allows researchers to download data
directly with R, a common coding language in the field of environmental
health research. Finally, function-izing data downloads is useful for
repeated code or automated analysis pipelines.</p>
</div>
<div class="section level2">
<h2 id="data_download">data_download()<a class="anchor" aria-label="anchor" href="#data_download"></a>
</h2>
<p><code>data_download()</code> is capable of accessing and downloading
geospatial data sets, collections, and variables from a variety of
sources. This wrapper function calls on source-specific data download
functions, each utilizing a unique combination of input parameters, host
URL, naming convention, and data formats.</p>
<table class="table">
<caption>Source-Specific Download Functions and Sources</caption>
<colgroup>
<col width="25%">
<col width="74%">
</colgroup>
<thead><tr class="header">
<th align="left">Function</th>
<th align="left">Source</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">download_aqs_data</td>
<td align="left"><a href="https://aqs.epa.gov/aqsweb/airdata/download_files.html" class="external-link">US EPA Air
Data Pre-Generated Data Files</a></td>
</tr>
<tr class="even">
<td align="left">download_ecoregion_data</td>
<td align="left"><a href="https://www.epa.gov/eco-research/ecoregions" class="external-link">US EPA
Ecoregions</a></td>
</tr>
<tr class="odd">
<td align="left">download_geos_cf_data</td>
<td align="left"><a href="https://gmao.gsfc.nasa.gov/GEOS_systems/" class="external-link">NASA
Goddard Earth Observing System Composition Forecasting
(GEOS-CF)</a></td>
</tr>
<tr class="even">
<td align="left">download_gmted_data</td>
<td align="left"><a href="https://www.usgs.gov/coastal-changes-and-impacts/gmted2010" class="external-link">USGS
Global Multi-resolution Terrain Elevation Data (GMTED2010)</a></td>
</tr>
<tr class="odd">
<td align="left">download_koppen_geiger_data</td>
<td align="left"><a href="https://www.nature.com/articles/sdata2018214" class="external-link">Köppen-Geiger
Climate Classification (Beck et al., 2018)</a></td>
</tr>
<tr class="even">
<td align="left">download_merra2_data</td>
<td align="left"><a href="https://gmao.gsfc.nasa.gov/reanalysis/MERRA-2/" class="external-link">NASA Modern-Era
Retrospective analysis for Research and Applications, Version 2
(MERRA-2)</a></td>
</tr>
<tr class="odd">
<td align="left">download_narr_monolevel_data</td>
<td align="left"><a href="https://psl.noaa.gov/data/gridded/data.narr.html" class="external-link">NOAA NCEP North
American Regional Reanalysis (NARR) (monolevel variables)</a></td>
</tr>
<tr class="even">
<td align="left">download_narr_p_levels_data</td>
<td align="left"><a href="https://psl.noaa.gov/data/gridded/data.narr.html" class="external-link">NOAA NCEP North
American Regional Reanalysis (NARR) (pressure levels variables)</a></td>
</tr>
<tr class="odd">
<td align="left">download_nlcd_data</td>
<td align="left"><a href="https://www.mrlc.gov/data" class="external-link">MRLC Consortium
National Land Cover Database (NLCD)</a></td>
</tr>
<tr class="even">
<td align="left">download_hms_data</td>
<td align="left"><a href="https://www.ospo.noaa.gov/Products/land/hms.html#0" class="external-link">NOAA Hazard
Mapping System Fire and Smoke Product</a></td>
</tr>
<tr class="odd">
<td align="left">download_sedac_groads_data</td>
<td align="left"><a href="https://sedac.ciesin.columbia.edu/data/set/groads-global-roads-open-access-v1/data-download" class="external-link">NASA
SEDAC Global Roads Open Access Data Set</a></td>
</tr>
<tr class="even">
<td align="left">download_sedac_population_data</td>
<td align="left"><a href="https://sedac.ciesin.columbia.edu/data/set/gpw-v4-population-density-adjusted-to-2015-unwpp-country-totals-rev11" class="external-link">NASA
SEDAC UN WPP-Adjusted Population Density</a></td>
</tr>
<tr class="odd">
<td align="left">download_modis_data</td>
<td align="left"><a href="https://modis.gsfc.nasa.gov/data/" class="external-link">NASA
Moderate Resolution Imaging Spectroradiometer (MODIS)</a></td>
</tr>
</tbody>
</table>
<p>It is important to note that <code>data_download()</code> calls a
source-specific function based on the <code>dataset_name =</code>
parameter. Using the source-specific function directly will return the
exact same data (<strong>if the parameters are the same</strong>), but
<code>data_download()</code> may be beneficial if using a
<code>for</code> loop to download data from various sources. For
example, <code>download_data(dataset_name = "hms", ...)</code> will
return the same data as <code>download_hms_data(...)</code> assuming
that <code>...</code> indicates the same parameters.</p>
<div class="section level3">
<h3 id="parameters">Parameters<a class="anchor" aria-label="anchor" href="#parameters"></a>
</h3>
<p>User-defined parameters differ based on the data source. Required
parameters for each source can be checked with
<code>names(formals())</code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/formals.html" class="external-link">formals</a></span><span class="op">(</span><span class="va">download_hms_data</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] "date_start"                    "date_end"                     </span></span>
<span><span class="co">##  [3] "data_format"                   "directory_to_download"        </span></span>
<span><span class="co">##  [5] "directory_to_save"             "data_download_acknowledgement"</span></span>
<span><span class="co">##  [7] "download"                      "remove_command"               </span></span>
<span><span class="co">##  [9] "unzip"                         "remove_zip"</span></span></code></pre>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/formals.html" class="external-link">formals</a></span><span class="op">(</span><span class="va">download_narr_monolevel_data</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "year_start"                    "year_end"                     </span></span>
<span><span class="co">## [3] "variables"                     "directory_to_save"            </span></span>
<span><span class="co">## [5] "data_download_acknowledgement" "download"                     </span></span>
<span><span class="co">## [7] "remove_command"</span></span></code></pre>
<p>The two functions have different required parameters because
<code><a href="../reference/download_hms_data.html">download_hms_data()</a></code> uses a daily temporal resolution while
<code><a href="../reference/download_narr_monolevel_data.html">download_narr_monolevel_data()</a></code> uses yearly, but they share
some common, standard parameters.</p>
<div class="section level4">
<h4 id="standard-parameters">Standard parameters<a class="anchor" aria-label="anchor" href="#standard-parameters"></a>
</h4>
<p>Four parameters are included in all of the data download
functions.</p>
<table class="table">
<colgroup>
<col width="14%">
<col width="4%">
<col width="80%">
</colgroup>
<thead><tr class="header">
<th align="left">Parameter</th>
<th align="left">Type</th>
<th align="left">Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">directory_to_save</td>
<td align="left">Character</td>
<td align="left">There must be a directory to save downloaded data.
Default = ‘./input/DATASET_NAME/’.</td>
</tr>
<tr class="even">
<td align="left">data_download_acknowledgement</td>
<td align="left">Logical</td>
<td align="left">User must acknowledge that downloading geospatial data
can be very lage and may use lots of machine storage and memory.</td>
</tr>
<tr class="odd">
<td align="left">download</td>
<td align="left">Logical</td>
<td align="left">Run or skip the data download. Utilized primarily for
unit tests (see <a href="#unit-tests">Unit Tests</a>).</td>
</tr>
<tr class="even">
<td align="left">remove_command</td>
<td align="left">Logical</td>
<td align="left">Remove or retain the text file containing the generated
download commands. Utilized primarily for unit tests (see <a href="#unit-tests">Unit Tests</a> and <a href="#initiate-commands.txt">4. Initiate “…commands.txt”</a>).</td>
</tr>
</tbody>
</table>
<p>Additionally, the <code>dataset_name =</code> parameter must be
specified when using <code>data_download()</code>, but is assumed when
using a source-specific download function.</p>
</div>
</div>
<div class="section level3">
<h3 id="function-structure">Function Structure<a class="anchor" aria-label="anchor" href="#function-structure"></a>
</h3>
<p>Although each source-specific download function is unique, they all
follow the same general structure. The following chunks of code have
been <strong>adopted</strong> from <code><a href="../reference/download_hms_data.html">download_hms_data()</a></code> to
demonstrate the functions’ structure.</p>
<p><a href="#clean-parameters">1. Clean Parameters</a></p>
<p><a href="#generate-download-urls">2. Generate Download URLs</a></p>
<p><a href="#generate-download-file-names">3. Generate download file
names</a></p>
<p><a href="#initiate-commands.txt">4. Initiate “…commands.txt”</a></p>
<p><a href="#concatenate-download-commands">5. Concatenate download
commands</a></p>
<p><a href="#finalize-commands.txt">6. Finalize “…commands.txt”</a></p>
<p><a href="#run-commands-in-commands.txt">7. Run commands in
“…commands.txt”</a></p>
<p><a href="#zip-files-if-applicable">8. Zip files (if
applicable)</a></p>
<div class="section level4">
<h4 id="clean-parameters">1. Clean parameters<a class="anchor" aria-label="anchor" href="#clean-parameters"></a>
</h4>
<p>Cleaning the user-defined parameters is highly dependent on the
parameters themselves and the desired URL to be created. A common
parameter cleaning step is creating a date-time sequence based on a
given temporal range and required format, in this case
<code>YYYYMMDD</code>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># user defined parameters</span></span>
<span><span class="va">date_start</span> <span class="op">&lt;-</span> <span class="st">"2023-12-28"</span></span>
<span><span class="va">date_end</span> <span class="op">&lt;-</span> <span class="st">"2024-01-02"</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">date_sequence</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="va">date_start</span>, format <span class="op">=</span> <span class="st">"%Y-%m-%d"</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="va">date_end</span>, format <span class="op">=</span> <span class="st">"%Y-%m-%d"</span><span class="op">)</span>,</span>
<span>  <span class="st">"day"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">date_sequence</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"-"</span>, <span class="st">""</span>, <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">date_sequence</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">date_sequence</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "20231228" "20231229" "20231230" "20231231" "20240101" "20240102"</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="generate-download-urls">2. Generate download URLs<a class="anchor" aria-label="anchor" href="#generate-download-urls"></a>
</h4>
<p>The URL base and pattern are identified by manually inspecting the
download link on the source-specific web page.
<code><a href="../reference/download_hms_data.html">download_hms_data()</a></code> utilizes the year, month, date, and
data format to generate the download url.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># user defined parameters</span></span>
<span><span class="va">data_format</span> <span class="op">&lt;-</span> <span class="st">"Shapefile"</span></span>
<span><span class="va">suffix</span> <span class="op">&lt;-</span> <span class="st">".zip"</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">urls</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">d</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">date_sequence</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">year</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span><span class="va">date_sequence</span><span class="op">[</span><span class="va">d</span><span class="op">]</span>, <span class="fl">1</span>, <span class="fl">4</span><span class="op">)</span></span>
<span>  <span class="va">month</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span><span class="va">date_sequence</span><span class="op">[</span><span class="va">d</span><span class="op">]</span>, <span class="fl">5</span>, <span class="fl">6</span><span class="op">)</span></span>
<span>  <span class="va">base</span> <span class="op">&lt;-</span> <span class="st">"https://satepsanone.nesdis.noaa.gov/pub/FIRE/web/HMS/Smoke_Polygons/"</span></span>
<span>  <span class="va">url</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span></span>
<span>    <span class="va">base</span>,</span>
<span>    <span class="va">data_format</span>,</span>
<span>    <span class="st">"/"</span>,</span>
<span>    <span class="va">year</span>,</span>
<span>    <span class="st">"/"</span>,</span>
<span>    <span class="va">month</span>,</span>
<span>    <span class="st">"/hms_smoke"</span>,</span>
<span>    <span class="va">date_sequence</span><span class="op">[</span><span class="va">d</span><span class="op">]</span>,</span>
<span>    <span class="va">suffix</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="va">urls</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">urls</span>, <span class="va">url</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">urls</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "https://satepsanone.nesdis.noaa.gov/pub/FIRE/web/HMS/Smoke_Polygons/Shapefile/2023/12/hms_smoke20231228.zip"</span></span>
<span><span class="co">## [2] "https://satepsanone.nesdis.noaa.gov/pub/FIRE/web/HMS/Smoke_Polygons/Shapefile/2023/12/hms_smoke20231229.zip"</span></span>
<span><span class="co">## [3] "https://satepsanone.nesdis.noaa.gov/pub/FIRE/web/HMS/Smoke_Polygons/Shapefile/2023/12/hms_smoke20231230.zip"</span></span>
<span><span class="co">## [4] "https://satepsanone.nesdis.noaa.gov/pub/FIRE/web/HMS/Smoke_Polygons/Shapefile/2023/12/hms_smoke20231231.zip"</span></span>
<span><span class="co">## [5] "https://satepsanone.nesdis.noaa.gov/pub/FIRE/web/HMS/Smoke_Polygons/Shapefile/2024/01/hms_smoke20240101.zip"</span></span>
<span><span class="co">## [6] "https://satepsanone.nesdis.noaa.gov/pub/FIRE/web/HMS/Smoke_Polygons/Shapefile/2024/01/hms_smoke20240102.zip"</span></span></code></pre>
<p>A download URL is created for each date in <code>date_sequence</code>
based on the fixed pattern.</p>
</div>
<div class="section level4">
<h4 id="generate-download-file-names">3. Generate download file names<a class="anchor" aria-label="anchor" href="#generate-download-file-names"></a>
</h4>
<p>The generation of download file names also follows a fixed pattern,
typically a combination of the user-defined download directory, data set
name, spatiotemporal characteristic, data type, and, if applicable,
specific variable name. Unlike the download URLs, the download file
names can be defined in any way by the writer of the function, but using
the previously defined characteristics is useful for identification.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># user defined parameters</span></span>
<span><span class="va">directory_to_download</span> <span class="op">&lt;-</span> <span class="st">"./data/"</span></span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">download_file_names</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">d</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">date_sequence</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">download_file_name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span></span>
<span>    <span class="va">directory_to_download</span>,</span>
<span>    <span class="st">"hms_smoke_"</span>,</span>
<span>    <span class="va">data_format</span>,</span>
<span>    <span class="st">"_"</span>,</span>
<span>    <span class="va">date_sequence</span><span class="op">[</span><span class="va">d</span><span class="op">]</span>,</span>
<span>    <span class="va">suffix</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="va">download_file_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">download_file_names</span>, <span class="va">download_file_name</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">download_file_names</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "./data/hms_smoke_Shapefile_20231228.zip"</span></span>
<span><span class="co">## [2] "./data/hms_smoke_Shapefile_20231229.zip"</span></span>
<span><span class="co">## [3] "./data/hms_smoke_Shapefile_20231230.zip"</span></span>
<span><span class="co">## [4] "./data/hms_smoke_Shapefile_20231231.zip"</span></span>
<span><span class="co">## [5] "./data/hms_smoke_Shapefile_20240101.zip"</span></span>
<span><span class="co">## [6] "./data/hms_smoke_Shapefile_20240102.zip"</span></span></code></pre>
<p>A download URL is created for each date in <code>date_sequence</code>
based on the fixed pattern.</p>
</div>
<div class="section level4">
<h4 id="initiate-commands-txt">4. Initiate “…commands.txt”<a class="anchor" aria-label="anchor" href="#initiate-commands-txt"></a>
</h4>
<p>An important aspect of the data download function is its
<code>sink()...cat()...sink()</code> structure. Rather than using the
<code><a href="https://rdrr.io/r/utils/download.file.html" class="external-link">utils::download.file()</a></code> function, a text file is created to
store all of the download commands generated from the URLs and file
names.</p>
<p>This structure is utilized for several reasons:</p>
<ul>
<li><p>Consistent structure for all the source-specific download
functions.</p></li>
<li><p>The <code><a href="https://rdrr.io/r/utils/download.file.html" class="external-link">download.file()</a></code> function cannot accept vectors
of URLs and destination files for downloading. An additional
<code>for</code> loop to download data will increase function complexity
and may reduce performance.</p></li>
<li><p>Writing commands in Bash (Unix shell) script allows for specific
arguments and flags.</p></li>
<li><p>Storing the download URLs without immediately running the
download allows for unit testing and URL checking (more on this in <a href="#unit-tests">Unit Tests</a>).</p></li>
</ul>
<p>The text file containing the download commands is named based on the
data set, temporal range, and data transfer method.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">commands_txt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span></span>
<span>  <span class="va">directory_to_download</span>,</span>
<span>  <span class="st">"hms_smoke_"</span>,</span>
<span>  <span class="fu"><a href="https://rspatial.github.io/terra/reference/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="va">date_sequence</span>, n <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>  <span class="st">"_"</span>,</span>
<span>  <span class="fu"><a href="https://rspatial.github.io/terra/reference/headtail.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">date_sequence</span>, n <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>  <span class="st">"_curl_commands.txt"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Create and sink the text file.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/sink.html" class="external-link">sink</a></span><span class="op">(</span><span class="va">commands_txt</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="concatenate-download-commands">5. Concatenate download commands<a class="anchor" aria-label="anchor" href="#concatenate-download-commands"></a>
</h4>
<p>The Linux-based download commands are written according to the data
transfer method, download URL, download file name, and additional
arguments. Which additional arguments are included, and their order,
depend on the data transfer method and URL type.</p>
<p>For more information on <code>curl</code> and <code>wget</code>, the
two data transfer methods utilized by the data download functions, see
<a href="https://curl.se/docs/manpage.html" class="external-link">curl.1 the man page</a> and
<a href="https://www.gnu.org/software/wget/manual/wget.html" class="external-link">GNU Wget
1.21.1-dirty Manual</a> (latest version as of January 8, 2024).</p>
<p>The <code><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat()</a></code> function will store each of the download
commands written in the <code>for</code> loop to the previously sunk
commands text file (<code>commands_txt</code>).</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">for</span> <span class="op">(</span><span class="va">d</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">date_sequence</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">download_comamnd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span></span>
<span>    <span class="st">"curl -s -o "</span>,</span>
<span>    <span class="va">download_file_names</span><span class="op">[</span><span class="va">d</span><span class="op">]</span>,</span>
<span>    <span class="st">" --url "</span>,</span>
<span>    <span class="va">urls</span><span class="op">[</span><span class="va">d</span><span class="op">]</span>,</span>
<span>    <span class="st">"\n"</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="va">download_comamnd</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="finalize-commands-txt">6. Finalize “…commands.txt”<a class="anchor" aria-label="anchor" href="#finalize-commands-txt"></a>
</h4>
<p>After the download commands have been concatenated to the commands
text file, a second <code><a href="https://rdrr.io/r/base/sink.html" class="external-link">sink()</a></code> command is run to finalize the
file and stop the appending of R output.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/sink.html" class="external-link">sink</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="run-commands-in-commands-txt">7. Run commands in “…commands.txt”<a class="anchor" aria-label="anchor" href="#run-commands-in-commands-txt"></a>
</h4>
<p>A “system command” must be created to run all of the download
commands stored in the commands text file. In bash script,
<code>.</code> indicates to run all of the commands within a given
script. In this case, we will run all of the commands within the
commands text file.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">system_command</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span></span>
<span>  <span class="st">". "</span>,</span>
<span>  <span class="va">commands_txt</span>,</span>
<span>  <span class="st">"\n"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">system_command</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] ". ./data/hms_smoke_20231228_20240102_curl_commands.txt\n"</span></span></code></pre>
<p>Running the <code>system_command</code> deploys a “helper function”,
<code><a href="../reference/download_run.html">download_run()</a></code>, a function created to reduce repeated code
across the source-specific download functions. The function takes two
parameters, <code>system_command =</code>, which indicates the command
to be run, and <code>download =</code>, a user-defined logical
parameter.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">download_run</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span></span>
<span>    <span class="va">download</span> <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    <span class="va">system_command</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">download</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Downloading requested files...\n"</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/system.html" class="external-link">system</a></span><span class="op">(</span>command <span class="op">=</span> <span class="va">system_command</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Requested files have been downloaded.\n"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Skipping data download.\n"</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>The data download is initiated by running <code><a href="../reference/download_run.html">download_run()</a></code>
with the system command identified and <code>download = TRUE</code>.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/download_run.html">download_run</a></span><span class="op">(</span></span>
<span>  download <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  system_command <span class="op">=</span> <span class="va">system_command</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Checking the download directory shows that all of the requested files
have been downloaded.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span>path <span class="op">=</span> <span class="va">directory_to_download</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "hms_smoke_Shapefile_20231228.zip" "hms_smoke_Shapefile_20231229.zip"</span></span>
<span><span class="co">## [3] "hms_smoke_Shapefile_20231230.zip" "hms_smoke_Shapefile_20231231.zip"</span></span>
<span><span class="co">## [5] "hms_smoke_Shapefile_20240101.zip" "hms_smoke_Shapefile_20240102.zip"</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="zip-files-if-applicable">8. Zip files (if applicable)<a class="anchor" aria-label="anchor" href="#zip-files-if-applicable"></a>
</h4>
<p>All of the source-specific data download functions follow this
general pattern, but those functions which download zip files require
additional steps to inflate and remove the downloaded zip files, if
desired. Each of these two steps are run by helper functions, and they
are run by the user-defined <code>unzip =</code> and
<code>remove_zip =</code> parameters in
<code>data_download()</code>.</p>
<p><code><a href="../reference/download_unzip.html">download_unzip()</a></code> inflates zip files if
<code>unzip = TRUE</code>, and skips inflation if
<code>unzip = FALSE</code>.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">download_unzip</span> <span class="op">&lt;-</span></span>
<span>  <span class="kw">function</span><span class="op">(</span><span class="va">file_name</span>,</span>
<span>           <span class="va">directory_to_unzip</span>,</span>
<span>           <span class="va">unzip</span> <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="va">unzip</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Downloaded files will not be unzipped.\n"</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Unzipping files...\n"</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/utils/unzip.html" class="external-link">unzip</a></span><span class="op">(</span><span class="va">file_name</span>,</span>
<span>      exdir <span class="op">=</span> <span class="va">directory_to_unzip</span></span>
<span>    <span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span></span>
<span>      <span class="st">"Files unzipped and saved in "</span>,</span>
<span>      <span class="va">directory_to_unzip</span>,</span>
<span>      <span class="st">".\n"</span></span>
<span>    <span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span></code></pre></div>
<p><code><a href="../reference/download_remove_zips.html">download_remove_zips()</a></code> removes the downloaded zip files
if <code>remove = TRUE</code>, and skips removal if
<code>remove = FALSE</code>.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">download_remove_zips</span> <span class="op">&lt;-</span></span>
<span>  <span class="kw">function</span><span class="op">(</span><span class="va">remove</span> <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>           <span class="va">download_name</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">remove</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Removing download files...\n"</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.remove</a></span><span class="op">(</span><span class="va">download_name</span><span class="op">)</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Download files removed.\n"</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span></code></pre></div>
<p>For this demonstration we will unzip (inflate) the downloaded zip
files but we will not delete them.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">for</span> <span class="op">(</span><span class="va">f</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">download_file_names</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/download_unzip.html">download_unzip</a></span><span class="op">(</span></span>
<span>    file_name <span class="op">=</span> <span class="va">download_file_names</span><span class="op">[</span><span class="va">f</span><span class="op">]</span>,</span>
<span>    directory_to_unzip <span class="op">=</span> <span class="va">directory_to_download</span>,</span>
<span>    unzip <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="../reference/download_remove_zips.html">download_remove_zips</a></span><span class="op">(</span></span>
<span>  download_name <span class="op">=</span> <span class="va">download_file_names</span>,</span>
<span>  remove <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Unzipping files...</span></span>
<span><span class="co">## Files unzipped and saved in ./data/.</span></span>
<span><span class="co">## Unzipping files...</span></span>
<span><span class="co">## Files unzipped and saved in ./data/.</span></span>
<span><span class="co">## Unzipping files...</span></span>
<span><span class="co">## Files unzipped and saved in ./data/.</span></span>
<span><span class="co">## Unzipping files...</span></span>
<span><span class="co">## Files unzipped and saved in ./data/.</span></span>
<span><span class="co">## Unzipping files...</span></span>
<span><span class="co">## Files unzipped and saved in ./data/.</span></span>
<span><span class="co">## Unzipping files...</span></span>
<span><span class="co">## Files unzipped and saved in ./data/.</span></span></code></pre>
<p>Listing the files again shows that the contents of the zip files have
been inflated and the zip files have been retained.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span>path <span class="op">=</span> <span class="va">directory_to_download</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] "hms_smoke_Shapefile_20231228.zip" "hms_smoke_Shapefile_20231229.zip"</span></span>
<span><span class="co">##  [3] "hms_smoke_Shapefile_20231230.zip" "hms_smoke_Shapefile_20231231.zip"</span></span>
<span><span class="co">##  [5] "hms_smoke_Shapefile_20240101.zip" "hms_smoke_Shapefile_20240102.zip"</span></span>
<span><span class="co">##  [7] "hms_smoke20231228.dbf"            "hms_smoke20231228.prj"           </span></span>
<span><span class="co">##  [9] "hms_smoke20231228.shp"            "hms_smoke20231228.shx"           </span></span>
<span><span class="co">## [11] "hms_smoke20231229.dbf"            "hms_smoke20231229.prj"           </span></span>
<span><span class="co">## [13] "hms_smoke20231229.shp"            "hms_smoke20231229.shx"           </span></span>
<span><span class="co">## [15] "hms_smoke20231230.dbf"            "hms_smoke20231230.prj"           </span></span>
<span><span class="co">## [17] "hms_smoke20231230.shp"            "hms_smoke20231230.shx"           </span></span>
<span><span class="co">## [19] "hms_smoke20231231.dbf"            "hms_smoke20231231.prj"           </span></span>
<span><span class="co">## [21] "hms_smoke20231231.shp"            "hms_smoke20231231.shx"           </span></span>
<span><span class="co">## [23] "hms_smoke20240101.dbf"            "hms_smoke20240101.prj"           </span></span>
<span><span class="co">## [25] "hms_smoke20240101.shp"            "hms_smoke20240101.shx"           </span></span>
<span><span class="co">## [27] "hms_smoke20240102.dbf"            "hms_smoke20240102.prj"           </span></span>
<span><span class="co">## [29] "hms_smoke20240102.shp"            "hms_smoke20240102.shx"</span></span></code></pre>
<p>The download function was structured successfully.</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="unit-tests">Unit Tests<a class="anchor" aria-label="anchor" href="#unit-tests"></a>
</h2>
<p>The previous outline successfully cleaned parameters, generated URLs,
and downloaded data, but how can we be sure that it will continue to
work with different temporal ranges and data types? To this end, unit
tests have been implemented to ensure that each data download function
runs properly and that URLs produced by <a href="#generate-download-urls">2. Generate download URLs</a> are valid
and accessible. Like the download functions, the unit tests rely on
“helper” functions to reduce repeated code across the tests.</p>
<div class="section level3">
<h3 id="helper-functions">Helper functions<a class="anchor" aria-label="anchor" href="#helper-functions"></a>
</h3>
<p><code><a href="../reference/read_commands.html">read_commands()</a></code> imports the commands text file and
converts the data frame to a vector.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">read_commands</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span></span>
<span>    <span class="va">commands_path</span> <span class="op">=</span> <span class="va">commands_path</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">commands</span> <span class="op">&lt;-</span> <span class="fu">utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="va">commands_path</span>, header <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="va">commands</span> <span class="op">&lt;-</span> <span class="va">commands</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">commands</span><span class="op">)</span><span class="op">)</span>, <span class="op">]</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">commands</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><code><a href="../reference/extract_urls.html">extract_urls()</a></code> extracts each download URL from the
vector of commands. The <code>position =</code> of the URL within the
download command is determined in <a href="#concatenate-download-commands">5. Concatenate download
commands</a>.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># function to extract URLs from vector</span></span>
<span><span class="va">extract_urls</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span></span>
<span>    <span class="va">commands</span> <span class="op">=</span> <span class="va">commands</span>,</span>
<span>    <span class="va">position</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">position</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"URL position in command is not defined.\n"</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">url_list</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">c</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">commands</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">url</span> <span class="op">&lt;-</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_split.html" class="external-link">str_split_i</a></span><span class="op">(</span><span class="va">commands</span><span class="op">[</span><span class="va">c</span><span class="op">]</span>, <span class="st">" "</span>, <span class="va">position</span><span class="op">)</span></span>
<span>    <span class="va">url_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">url_list</span>, <span class="va">url</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">url_list</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><code><a href="../reference/check_url_status.html">check_url_status()</a></code> is the most important of the download
test “helper” functions. This function utilizes
<code><a href="https://httr.r-lib.org/reference/HEAD.html" class="external-link">httr::HEAD()</a></code> and <code><a href="https://httr.r-lib.org/reference/GET.html" class="external-link">httr::GET()</a></code> to check the HTTP
response status of a given URL. The desired HTTP response status is 200,
which means the URL is valid and accessible.
<code><a href="../reference/check_url_status.html">check_url_status()</a></code> returns a logical value to indicate
whether the URL returns HTTP status 200 (<code>TRUE</code>) or not
(<code>FALSE</code>). For more information on HTTP status’, see <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Status" class="external-link">HTTP
response status codes</a>.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">check_url_status</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span></span>
<span>    <span class="va">url</span>,</span>
<span>    <span class="va">method</span> <span class="op">=</span> <span class="st">"HEAD"</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">http_status_ok</span> <span class="op">&lt;-</span> <span class="fl">200</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">method</span> <span class="op">==</span> <span class="st">"HEAD"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">hd</span> <span class="op">&lt;-</span> <span class="fu">httr</span><span class="fu">::</span><span class="fu"><a href="https://httr.r-lib.org/reference/HEAD.html" class="external-link">HEAD</a></span><span class="op">(</span><span class="va">url</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">method</span> <span class="op">==</span> <span class="st">"GET"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">hd</span> <span class="op">&lt;-</span> <span class="fu">httr</span><span class="fu">::</span><span class="fu"><a href="https://httr.r-lib.org/reference/GET.html" class="external-link">GET</a></span><span class="op">(</span><span class="va">url</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">status</span> <span class="op">&lt;-</span> <span class="va">hd</span><span class="op">$</span><span class="va">status_code</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">status</span> <span class="op">==</span> <span class="va">http_status_ok</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><code><a href="../reference/check_urls.html">check_urls()</a></code> applies <code><a href="../reference/check_url_status.html">check_url_status()</a></code> to
a random sample of URLs extracted by <code><a href="../reference/extract_urls.html">extract_urls()</a></code>. The
sample size will vary based on the data set and spatio-temporal
parameters being tested. The function returns a logical vector
containing the output from <code><a href="../reference/check_url_status.html">check_url_status()</a></code>.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">check_urls</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span></span>
<span>    <span class="va">urls</span> <span class="op">=</span> <span class="va">urls</span>,</span>
<span>    <span class="va">size</span> <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    <span class="va">method</span> <span class="op">=</span> <span class="st">"HEAD"</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">size</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"URL sample size is not defined.\n"</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">urls</span><span class="op">)</span> <span class="op">&lt;</span> <span class="va">size</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">size</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">urls</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">url_sample</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">urls</span>, <span class="va">size</span>, replace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="va">url_status</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">url_sample</span>,</span>
<span>    <span class="va">check_url_status</span>,</span>
<span>    method <span class="op">=</span> <span class="va">method</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">url_status</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="testthat">testthat<a class="anchor" aria-label="anchor" href="#testthat"></a>
</h3>
<p>To demonstrate a test in action, test the URLs generated by
<code><a href="../reference/download_data.html">download_data()</a></code> for the NOAA HMS Smoke data set.</p>
<p>For more information see <a href="https://testthat.r-lib.org/" class="external-link">testthat</a>.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://testthat.r-lib.org" class="external-link">testthat</a></span><span class="op">)</span></span>
<span><span class="fu">testthat</span><span class="fu">::</span><span class="fu"><a href="https://testthat.r-lib.org/reference/test_that.html" class="external-link">test_that</a></span><span class="op">(</span></span>
<span>  <span class="st">"Valid dates return HTTP response status = 200."</span>,</span>
<span>  <span class="op">{</span></span>
<span>    <span class="co"># parameters</span></span>
<span>    <span class="va">test_start</span> <span class="op">&lt;-</span> <span class="st">"2023-12-28"</span></span>
<span>    <span class="va">test_end</span> <span class="op">&lt;-</span> <span class="st">"2024-01-02"</span></span>
<span>    <span class="va">test_directory</span> <span class="op">&lt;-</span> <span class="st">"./data"</span></span>
<span>    <span class="co"># download</span></span>
<span>    <span class="fu"><a href="../reference/download_data.html">download_data</a></span><span class="op">(</span></span>
<span>      dataset_name <span class="op">=</span> <span class="st">"noaa"</span>,</span>
<span>      date_start <span class="op">=</span> <span class="va">test_start</span>,</span>
<span>      date_end <span class="op">=</span> <span class="va">test_end</span>,</span>
<span>      data_format <span class="op">=</span> <span class="st">"Shapefile"</span>,</span>
<span>      directory_to_download <span class="op">=</span> <span class="va">test_directory</span>,</span>
<span>      directory_to_save <span class="op">=</span> <span class="va">test_directory</span>,</span>
<span>      data_download_acknowledgement <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>      download <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>      remove_command <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>      unzip <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>      remove_zip <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>    <span class="op">)</span></span>
<span>    <span class="va">commands_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span></span>
<span>      <span class="va">test_directory</span>,</span>
<span>      <span class="st">"hms_smoke_"</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"-"</span>, <span class="st">""</span>, <span class="va">test_start</span><span class="op">)</span>,</span>
<span>      <span class="st">"_"</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"-"</span>, <span class="st">""</span>, <span class="va">test_end</span><span class="op">)</span>,</span>
<span>      <span class="st">"_curl_commands.txt"</span></span>
<span>    <span class="op">)</span></span>
<span>    <span class="co"># helpers</span></span>
<span>    <span class="va">commands</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_commands.html">read_commands</a></span><span class="op">(</span>commands_path <span class="op">=</span> <span class="va">commands_path</span><span class="op">)</span></span>
<span>    <span class="va">urls</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extract_urls.html">extract_urls</a></span><span class="op">(</span>commands <span class="op">=</span> <span class="va">commands</span>, position <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></span>
<span>    <span class="va">url_status</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/check_urls.html">check_urls</a></span><span class="op">(</span>urls <span class="op">=</span> <span class="va">urls</span>, size <span class="op">=</span> <span class="fl">6</span>, method <span class="op">=</span> <span class="st">"HEAD"</span><span class="op">)</span></span>
<span>    <span class="co"># test for true</span></span>
<span>    <span class="fu"><a href="https://testthat.r-lib.org/reference/logical-expectations.html" class="external-link">expect_true</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="va">url_status</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Skipping data download.</span></span>
<span><span class="co">## Downloaded files will not be unzipped.</span></span>
<span><span class="co">## Downloaded files will not be unzipped.</span></span>
<span><span class="co">## Downloaded files will not be unzipped.</span></span>
<span><span class="co">## Downloaded files will not be unzipped.</span></span>
<span><span class="co">## Downloaded files will not be unzipped.</span></span>
<span><span class="co">## Downloaded files will not be unzipped.</span></span>
<span><span class="co">## <span style="color: #00BB00;">Test passed</span> 😸</span></span></code></pre>
<p>Although the <code>testthat::test_that(...)</code> chunk contains 32
lines of code, the unit test is performed by
<code>expect_true(all(url_status))</code>. In words, this line is
expecting (<code><a href="https://testthat.r-lib.org/reference/logical-expectations.html" class="external-link">expect_true()</a></code>) that all (<code><a href="https://rdrr.io/r/base/all.html" class="external-link">all()</a></code>) of
the sampled URLs return HTTP response status 200
(<code>url_status</code>). Since this expectation was met, the test
passed!</p>
<p>For an alternate example, we can use a start and end date that are
known to not have data. As the URLs associated with these dates do not
exist, we expect the function will fail. This test utilizes
<code><a href="https://testthat.r-lib.org/reference/expect_error.html" class="external-link">expect_error()</a></code> because the <code>data_download()</code>
wrapper function returns an error message if the underlying
source-specific download function returns an error.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">testthat</span><span class="fu">::</span><span class="fu"><a href="https://testthat.r-lib.org/reference/test_that.html" class="external-link">test_that</a></span><span class="op">(</span></span>
<span>  <span class="st">"Invalid dates cause function to fail."</span>,</span>
<span>  <span class="op">{</span></span>
<span>    <span class="co"># parameters</span></span>
<span>    <span class="va">test_start</span> <span class="op">&lt;-</span> <span class="st">"1800-01-01"</span></span>
<span>    <span class="va">test_end</span> <span class="op">&lt;-</span> <span class="st">"1800-01-02"</span></span>
<span>    <span class="va">test_directory</span> <span class="op">&lt;-</span> <span class="st">"../inst/extdata/"</span></span>
<span>    <span class="co"># test for error</span></span>
<span>    <span class="fu">testthat</span><span class="fu">::</span><span class="fu"><a href="https://testthat.r-lib.org/reference/expect_error.html" class="external-link">expect_error</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="../reference/download_data.html">download_data</a></span><span class="op">(</span></span>
<span>        dataset_name <span class="op">=</span> <span class="st">"noaa"</span>,</span>
<span>        date_start <span class="op">=</span> <span class="va">test_start</span>,</span>
<span>        date_end <span class="op">=</span> <span class="va">test_end</span>,</span>
<span>        data_format <span class="op">=</span> <span class="st">"Shapefile"</span>,</span>
<span>        directory_to_download <span class="op">=</span> <span class="va">test_directory</span>,</span>
<span>        directory_to_save <span class="op">=</span> <span class="va">test_directory</span>,</span>
<span>        data_download_acknowledgement <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>        download <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>        remove_command <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>        unzip <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>        remove_zip <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## &lt;simpleError in what_to_run(directory_to_save = directory_to_save, data_download_acknowledgement = data_download_acknowledgement,     ...): Invalid date returns HTTP code 404. Check `date_start` parameter.</span></span>
<span><span class="co">## &gt;</span></span>
<span><span class="co">## function (date_start = "2023-09-01", date_end = "2023-09-01", </span></span>
<span><span class="co">##     data_format = "Shapefile", directory_to_download = "./input/noaa_hms/", </span></span>
<span><span class="co">##     directory_to_save = "./input/noaa_hms/", data_download_acknowledgement = FALSE, </span></span>
<span><span class="co">##     download = FALSE, remove_command = FALSE, unzip = TRUE, remove_zip = FALSE) </span></span>
<span><span class="co">## NULL</span></span>
<span><span class="co">## <span style="color: #00BB00;">Test passed</span> 🎊</span></span></code></pre>
<p>This test utilizes <code><a href="https://testthat.r-lib.org/reference/expect_error.html" class="external-link">expect_error()</a></code> because the
<code>data_download()</code> wrapper function returns an error message
if the underlying source-specific download function returns an error. If
we directly used the <code>download_hms_data</code> function, we would
expect and receive an error.</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">testthat</span><span class="fu">::</span><span class="fu"><a href="https://testthat.r-lib.org/reference/test_that.html" class="external-link">test_that</a></span><span class="op">(</span></span>
<span>  <span class="st">"Invalid dates cause function to fail."</span>,</span>
<span>  <span class="op">{</span></span>
<span>    <span class="co"># parameters</span></span>
<span>    <span class="va">test_start</span> <span class="op">&lt;-</span> <span class="st">"1800-01-01"</span></span>
<span>    <span class="va">test_end</span> <span class="op">&lt;-</span> <span class="st">"1800-01-02"</span></span>
<span>    <span class="va">test_directory</span> <span class="op">&lt;-</span> <span class="st">"../inst/extdata/"</span></span>
<span>    <span class="co"># test for error</span></span>
<span>    <span class="fu">testthat</span><span class="fu">::</span><span class="fu"><a href="https://testthat.r-lib.org/reference/expect_error.html" class="external-link">expect_error</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="../reference/download_hms_data.html">download_hms_data</a></span><span class="op">(</span></span>
<span>        date_start <span class="op">=</span> <span class="va">test_start</span>,</span>
<span>        date_end <span class="op">=</span> <span class="va">test_end</span>,</span>
<span>        data_format <span class="op">=</span> <span class="st">"Shapefile"</span>,</span>
<span>        directory_to_download <span class="op">=</span> <span class="va">test_directory</span>,</span>
<span>        directory_to_save <span class="op">=</span> <span class="va">test_directory</span>,</span>
<span>        data_download_acknowledgement <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>        download <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>        remove_command <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>        unzip <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>        remove_zip <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #00BB00;">Test passed</span> 😸</span></span></code></pre>
<p>As expected, the test passes because the NOAA HMS Smoke data set does
not contain data for January 1-2, 1800.</p>
<p>These unit tests are just two of many implemented on
<code><a href="../reference/download_data.html">download_data()</a></code> and the accompanying source-specific
download functions, but they demonstrate how unit testing helps build
stable code.</p>
</div>
</div>
<div class="section level2">
<h2 id="download-example">Download Example<a class="anchor" aria-label="anchor" href="#download-example"></a>
</h2>
<p>With the function structure outlined and the unit tests in place, we
can now perform a data download. To begin, check the parameters required
by the source-specific data download function.</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/formals.html" class="external-link">formals</a></span><span class="op">(</span><span class="va">download_hms_data</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] "date_start"                    "date_end"                     </span></span>
<span><span class="co">##  [3] "data_format"                   "directory_to_download"        </span></span>
<span><span class="co">##  [5] "directory_to_save"             "data_download_acknowledgement"</span></span>
<span><span class="co">##  [7] "download"                      "remove_command"               </span></span>
<span><span class="co">##  [9] "unzip"                         "remove_zip"</span></span></code></pre>
<p>Define the parameters.</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">date_start</span> <span class="op">&lt;-</span> <span class="st">"2023-12-28"</span></span>
<span><span class="va">date_end</span> <span class="op">&lt;-</span> <span class="st">"2024-01-02"</span></span>
<span><span class="va">data_format</span> <span class="op">&lt;-</span> <span class="st">"Shapefile"</span></span>
<span><span class="va">data_directory</span> <span class="op">&lt;-</span> <span class="st">"./download_example/"</span></span>
<span><span class="va">data_download_acknowledgement</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span></span>
<span><span class="va">download</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span> <span class="co"># run data download</span></span>
<span><span class="va">remove_command</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span> <span class="co"># delete "...commands.txt" file</span></span>
<span><span class="va">unzip</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span> <span class="co"># inflate (unzip) downloaded zip files</span></span>
<span><span class="va">remove_zip</span> <span class="op">&lt;-</span> <span class="cn">FALSE</span> <span class="co"># retain downloaded zip files</span></span></code></pre></div>
<p>Download the data.</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/download_data.html">download_data</a></span><span class="op">(</span></span>
<span>  dataset_name <span class="op">=</span> <span class="st">"hms"</span>,</span>
<span>  date_start <span class="op">=</span> <span class="va">date_start</span>,</span>
<span>  date_end <span class="op">=</span> <span class="va">date_end</span>,</span>
<span>  directory_to_download <span class="op">=</span> <span class="va">data_directory</span>,</span>
<span>  directory_to_save <span class="op">=</span> <span class="va">data_directory</span>,</span>
<span>  data_download_acknowledgement <span class="op">=</span> <span class="va">data_download_acknowledgement</span>,</span>
<span>  download <span class="op">=</span> <span class="va">download</span>,</span>
<span>  remove_command <span class="op">=</span> <span class="va">remove_command</span>,</span>
<span>  unzip <span class="op">=</span> <span class="va">unzip</span>,</span>
<span>  remove_zip <span class="op">=</span> <span class="va">remove_zip</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Downloading requested files...</span></span>
<span><span class="co">## Requested files have been downloaded.</span></span></code></pre>
<pre><code><span><span class="co">## Unzipping files...</span></span>
<span><span class="co">## Files unzipped and saved in ./download_example/.</span></span>
<span><span class="co">## Unzipping files...</span></span>
<span><span class="co">## Files unzipped and saved in ./download_example/.</span></span>
<span><span class="co">## Unzipping files...</span></span>
<span><span class="co">## Files unzipped and saved in ./download_example/.</span></span>
<span><span class="co">## Unzipping files...</span></span>
<span><span class="co">## Files unzipped and saved in ./download_example/.</span></span>
<span><span class="co">## Unzipping files...</span></span>
<span><span class="co">## Files unzipped and saved in ./download_example/.</span></span>
<span><span class="co">## Unzipping files...</span></span>
<span><span class="co">## Files unzipped and saved in ./download_example/.</span></span></code></pre>
<p>Checking the directory shows that all of our desired data has been
downloaded and inflated, and the original zip files have been
retained.</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">data_directory</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] "hms_smoke_Shapefile_20231228.zip" "hms_smoke_Shapefile_20231229.zip"</span></span>
<span><span class="co">##  [3] "hms_smoke_Shapefile_20231230.zip" "hms_smoke_Shapefile_20231231.zip"</span></span>
<span><span class="co">##  [5] "hms_smoke_Shapefile_20240101.zip" "hms_smoke_Shapefile_20240102.zip"</span></span>
<span><span class="co">##  [7] "hms_smoke20231228.dbf"            "hms_smoke20231228.prj"           </span></span>
<span><span class="co">##  [9] "hms_smoke20231228.shp"            "hms_smoke20231228.shx"           </span></span>
<span><span class="co">## [11] "hms_smoke20231229.dbf"            "hms_smoke20231229.prj"           </span></span>
<span><span class="co">## [13] "hms_smoke20231229.shp"            "hms_smoke20231229.shx"           </span></span>
<span><span class="co">## [15] "hms_smoke20231230.dbf"            "hms_smoke20231230.prj"           </span></span>
<span><span class="co">## [17] "hms_smoke20231230.shp"            "hms_smoke20231230.shx"           </span></span>
<span><span class="co">## [19] "hms_smoke20231231.dbf"            "hms_smoke20231231.prj"           </span></span>
<span><span class="co">## [21] "hms_smoke20231231.shp"            "hms_smoke20231231.shx"           </span></span>
<span><span class="co">## [23] "hms_smoke20240101.dbf"            "hms_smoke20240101.prj"           </span></span>
<span><span class="co">## [25] "hms_smoke20240101.shp"            "hms_smoke20240101.shx"           </span></span>
<span><span class="co">## [27] "hms_smoke20240102.dbf"            "hms_smoke20240102.prj"           </span></span>
<span><span class="co">## [29] "hms_smoke20240102.shp"            "hms_smoke20240102.shx"</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="nasa-earthdata-account">NASA EarthData Account<a class="anchor" aria-label="anchor" href="#nasa-earthdata-account"></a>
</h2>
<p>As mentioned in <a href="#motivation">Motivation</a>,
<code>data_download()</code> provides access to <strong>publicly
available</strong> geospatial data. Although publicly available, some of
the NASA data sources require a NASA EarthData Account.</p>
<p>For example, the UN WPP-Adjusted population density data from NASA
Socioeconomic Data and Applications Center (SEDAC) requires an EarthData
account. Without an EarthData Account and the prerequisite files
prepared, the data download functions will return an error.</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/download_data.html">download_data</a></span><span class="op">(</span></span>
<span>  dataset_name <span class="op">=</span> <span class="st">"sedac_population"</span>,</span>
<span>  year <span class="op">=</span> <span class="st">"2020"</span>,</span>
<span>  data_format <span class="op">=</span> <span class="st">"GeoTIFF"</span>,</span>
<span>  data_resolution <span class="op">=</span> <span class="st">"60 minute"</span>,</span>
<span>  directory_to_download <span class="op">=</span> <span class="st">"./sedac_population/"</span>,</span>
<span>  directory_to_save <span class="op">=</span> <span class="st">"./sedac_population"</span>,</span>
<span>  data_download_acknowledgement <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  download <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  unzip <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  remove_zip <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  remove_command <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Downloading requested files...</span></span>
<span><span class="co">## Requested files have been downloaded.</span></span>
<span><span class="co">## Unzipping files...</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Warning in unzip(file_name, exdir = directory_to_unzip): error 1 in extracting from zip file</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Files unzipped and saved in ./sedac_population/.</span></span></code></pre>
<p>The downloaded file cannot be unzipped because the data was not
downloaded properly.</p>
<div class="section level3">
<h3 id="register-or-log-in">Register or log in<a class="anchor" aria-label="anchor" href="#register-or-log-in"></a>
</h3>
<p>Visit <a href="http://urs.earthdata.nasa.gov" class="external-link">https://urs.earthdata.nasa.gov/</a>
to register for or log into a NASA EarthData account.</p>
<div class="figure">
<img src="../inst/extdata/vignette_images/NASA_EarthData_login.png" alt=""><p class="caption">NASA EarthData Account Landing Page</p>
</div>
<p>Account registration provides access to NASA’s Earth Observing System
Data and Information System (EOSDIS) and its twelve Distributed Active
Archive Centers (DAAC), including:</p>
<ul>
<li>Alaska Satellite Facility (ASF) DAAC</li>
<li>Atmospheric Science Data Center (ASDC)</li>
<li>Crustal Dynamics Data Information System (CDDIS)</li>
<li>Global Hydrometeorology Resource Center (GHRC)</li>
<li>Goddard Earth Sciences Data and Information Services Center (GES
DISC)</li>
<li>Land Processes DAAC (LP DAAC)</li>
<li>Level 1 and Atmosphere Archive and Distribution System (LAADS)
DAAC</li>
<li>National Snow and Ice Data Center (NSIDC) DAAC</li>
<li>Oak Ridge National Laboratory (ORNL) DAAC</li>
<li>Ocean Biology DAAC (OB.DAAC)</li>
<li>Physical Oceanography DAAC (PO.DAAC)</li>
<li>Socioeconomic Data and Applications Center (SEDAC)</li>
</ul>
<p>See <a href="https://www.earthdata.nasa.gov/eosdis/daacs" class="external-link uri">https://www.earthdata.nasa.gov/eosdis/daacs</a> for more
information.</p>
</div>
<div class="section level3">
<h3 id="approved-applications">Approved applications<a class="anchor" aria-label="anchor" href="#approved-applications"></a>
</h3>
<p>After creating an account, navigate to “My Profile”(<a href="https://urs.earthdata.nasa.gov/profile" class="external-link uri">https://urs.earthdata.nasa.gov/profile</a>), and then to
“Applications &gt; Authorized Apps”. This “Authorized Apps” page
specifies which NASA EarthData applications can use your login
credentials. For this example, ensure that authorization is enabled for
“SEDAC Website”, “SEDAC Website (Alpha)”, and “SEDAC Website
(Beta)”.</p>
<div class="figure">
<img src="../inst/extdata/vignette_images/NASA_EarthData_applications.png" alt=""><p class="caption">NASA EarthData Approved Applications</p>
</div>
</div>
<div class="section level3">
<h3 id="prerequisite-files">Prerequisite files<a class="anchor" aria-label="anchor" href="#prerequisite-files"></a>
</h3>
<p>With a NASA EarthData Account and the required applications
authorized to use the credentials, it is time to create the prerequisite
files.</p>
<p><strong>Note</strong> As the steps to produce the prerequisite files
is very specific, much of the code used is adopted from <a href="https://disc.gsfc.nasa.gov/information/howto?title=How%20to%20Generate%20Earthdata%20Prerequisite%20Files" class="external-link">How
to Generate Earthdata Prerequisite Files</a> on NASA GES DISC’s
“How-To’s” webpage (<a href="https://disc.gsfc.nasa.gov/information/howto" class="external-link">link</a>).</p>
<div class="section level4">
<h4 id="netrc">
<code>.netrc</code><a class="anchor" aria-label="anchor" href="#netrc"></a>
</h4>
<p>The following commands create the <code>.netrc</code> file, which
contains your NASA EarthData Account credentials.</p>
<p>First, set your working directory to the home directory. Setting a
working directory differs between Mac/Linux and Windows machines.</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="va">.Platform</span><span class="op">$</span><span class="va">OS.type</span> <span class="op">==</span> <span class="st">"unix"</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">setwd</a></span><span class="op">(</span><span class="st">"~/"</span><span class="op">)</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">.Platform</span><span class="op">$</span><span class="va">OS.type</span> <span class="op">==</span> <span class="st">"windows"</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">setwd</a></span><span class="op">(</span><span class="st">"C:/"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Create a file named <code>.netrc</code> with
<code><a href="https://rdrr.io/r/base/files.html" class="external-link">file.create()</a></code>.</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.create</a></span><span class="op">(</span><span class="st">".netrc"</span><span class="op">)</span></span></code></pre></div>
<p>Open a connection to <code>.netrc</code> with <code><a href="https://rdrr.io/r/base/sink.html" class="external-link">sink()</a></code>.
Write the line <code>machine urs...</code> replacing
<code>YOUR_USERNAME</code> and <code>YOUR_PASSWORD</code> with your NASA
EarthData username and password, respectively. After writing the line,
close the connection with <code><a href="https://rdrr.io/r/base/sink.html" class="external-link">sink()</a></code> again.</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/sink.html" class="external-link">sink</a></span><span class="op">(</span><span class="st">".netrc"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/writeLines.html" class="external-link">writeLines</a></span><span class="op">(</span></span>
<span>  <span class="st">"machine urs.earthdata.nasa.gov login YOUR_USERNAME password YOUR_PASSWORD"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sink.html" class="external-link">sink</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Edit the settings so only you, the owner of the file, can read and
write <code>.netrc</code>.</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/system.html" class="external-link">system</a></span><span class="op">(</span><span class="st">"chmod 0600 .netrc"</span><span class="op">)</span></span></code></pre></div>
<p>After, check to ensure the file was created properly.</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="st">".netrc"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] TRUE</span></span></code></pre>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/readLines.html" class="external-link">readLines</a></span><span class="op">(</span><span class="st">".netrc"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "machine urs.earthdata.nasa.gov login YOUR_USERNAME password YOUR_PASSWORD"</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="urs_cookies">
<code>.urs_cookies</code><a class="anchor" aria-label="anchor" href="#urs_cookies"></a>
</h4>
<p>The following commands create the <code>.urs_cookies</code> file.</p>
<p>First, set your working directory to the home directory.</p>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="va">.Platform</span><span class="op">$</span><span class="va">OS.type</span> <span class="op">==</span> <span class="st">"unix"</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">setwd</a></span><span class="op">(</span><span class="st">"~/"</span><span class="op">)</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">.Platform</span><span class="op">$</span><span class="va">OS.type</span> <span class="op">==</span> <span class="st">"windows"</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">setwd</a></span><span class="op">(</span><span class="st">"C:/"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Create a file named <code>.netrc</code> with
<code><a href="https://rdrr.io/r/base/files.html" class="external-link">file.create()</a></code>.</p>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.create</a></span><span class="op">(</span><span class="st">".urs_cookies"</span><span class="op">)</span></span></code></pre></div>
<p>After, check to ensure the file was created properly.</p>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="st">".urs_cookies"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] TRUE</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="dodsrc">
<code>.dodsrc</code><a class="anchor" aria-label="anchor" href="#dodsrc"></a>
</h4>
<p>The following commands create the <code>.urs_cookies</code> file.</p>
<p>First, set your working directory to the home directory.</p>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="va">.Platform</span><span class="op">$</span><span class="va">OS.type</span> <span class="op">==</span> <span class="st">"unix"</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">setwd</a></span><span class="op">(</span><span class="st">"~/"</span><span class="op">)</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">.Platform</span><span class="op">$</span><span class="va">OS.type</span> <span class="op">==</span> <span class="st">"windows"</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">setwd</a></span><span class="op">(</span><span class="st">"C:/"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Create a file named “.dodsrc” with <code><a href="https://rdrr.io/r/base/files.html" class="external-link">file.create()</a></code></p>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.create</a></span><span class="op">(</span><span class="st">".dodsrc"</span><span class="op">)</span></span></code></pre></div>
<p>Open a connection to <code>.dodsrc</code> with <code><a href="https://rdrr.io/r/base/sink.html" class="external-link">sink()</a></code>.
Write the lines beginning with <code>HTTP.</code>, replacing
<code>YOUR_USERNAME</code> and <code>YOUR_PASSWORD</code> with your NASA
EarthData username and password, respectively. After writing the line,
close the connection with <code><a href="https://rdrr.io/r/base/sink.html" class="external-link">sink()</a></code> again.</p>
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/sink.html" class="external-link">sink</a></span><span class="op">(</span><span class="st">".dodsrc"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/writeLines.html" class="external-link">writeLines</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span></span>
<span>    <span class="st">"HTTP.NETRC=YOUR_HOME_DIRECTORY/.netrc\n"</span>,</span>
<span>    <span class="st">"HTTP.COOKIE.JAR=YOUR_HOME_DIRECTORY/.urs_cookies"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sink.html" class="external-link">sink</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>After, check to ensure the file was created properly.</p>
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="st">".dodsrc"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] TRUE</span></span></code></pre>
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/readLines.html" class="external-link">readLines</a></span><span class="op">(</span><span class="st">".dodsrc"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "HTTP.NETRC=YOUR_HOME_DIRECTORY/.netrc"           </span></span>
<span><span class="co">## [2] "HTTP.COOKIE.JAR=YOUR_HOME_DIRECTORY/.urs_cookies"</span></span></code></pre>
<p>If working on a <strong>Windows</strong> machine, copy the
<code>.dodsrc</code> file to the project working directory. Replace
<code>YOUR_WORKING_DIRECTORY</code> with the absolute path to the
project working directory.</p>
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="va">.Platform</span><span class="op">$</span><span class="va">OS.type</span> <span class="op">==</span> <span class="st">"windows"</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.copy</a></span><span class="op">(</span></span>
<span>    <span class="st">"C:/.dodsrc"</span>,</span>
<span>    <span class="st">"YOUR_WORKING_DIRECTORY/.dodsrc"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>It is important to ensure that these commands, as well as your
username, password, and home directory, are typed without error, as a
single problem with any of these files will result in a failed
download.</p>
<p>If the files have been created correctly, the UN WPP-Adjusted
population density data from NASA Socioeconomic Data and Applications
Center (SEDAC) will be downloaded and unzipped without returning an
error.</p>
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/download_data.html">download_data</a></span><span class="op">(</span></span>
<span>  dataset_name <span class="op">=</span> <span class="st">"sedac_population"</span>,</span>
<span>  year <span class="op">=</span> <span class="st">"2020"</span>,</span>
<span>  data_format <span class="op">=</span> <span class="st">"GeoTIFF"</span>,</span>
<span>  data_resolution <span class="op">=</span> <span class="st">"60 minute"</span>,</span>
<span>  directory_to_download <span class="op">=</span> <span class="st">"./sedac_population/"</span>,</span>
<span>  directory_to_save <span class="op">=</span> <span class="st">"./sedac_population"</span>,</span>
<span>  data_download_acknowledgement <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  download <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  unzip <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  remove_zip <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  remove_command <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Downloading requested files...</span></span>
<span><span class="co">## Requested files have been downloaded.</span></span>
<span><span class="co">## Unzipping files...</span></span>
<span><span class="co">## Files unzipped and saved in ./sedac_population/.</span></span></code></pre>
<div class="sourceCode" id="cb73"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="st">"./sedac_population"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "gpw_v4_population_density_adjusted_to_2015_unwpp_country_totals_rev11_2020_1_deg_tif_readme.txt"</span></span>
<span><span class="co">## [2] "gpw_v4_population_density_adjusted_to_2015_unwpp_country_totals_rev11_2020_1_deg_tif.zip"       </span></span>
<span><span class="co">## [3] "gpw_v4_population_density_adjusted_to_2015_unwpp_country_totals_rev11_2020_1_deg.tif"</span></span></code></pre>
</div>
</div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<ul>
<li>EOSDIS Distributed Active Archive Centers (DAAC). <em>National
Aeronautics and Space Administration (NASA)</em>. Date accessed: January
3, 2024. <a href="">https://www.earthdata.nasa.gov/eosdis/daacs</a>.</li>
<li>How to Generate Earthdata Prerequisite Files. <em>National
Aeronautics and Space Administration (NASA)</em>. Date accessed: January
3, 2024. <a href="">https://disc.gsfc.nasa.gov/information/howto?title=How%20to%20Generate%20Earthdata%20Prerequisite%20Files</a>.</li>
</ul>
</div>
<div class="section level2">
<h2 id="code-example">Code Example<a class="anchor" aria-label="anchor" href="#code-example"></a>
</h2>
<p>The following is the entire R code used to create
<code><a href="../reference/download_hms_data.html">download_hms_data()</a></code>.</p>
<div class="sourceCode" id="cb75"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">download_hms_data</span></span></code></pre></div>
<pre><code><span><span class="co">## function (date_start = "2023-09-01", date_end = "2023-09-01", </span></span>
<span><span class="co">##     data_format = "Shapefile", directory_to_download = "./input/noaa_hms/", </span></span>
<span><span class="co">##     directory_to_save = "./input/noaa_hms/", data_download_acknowledgement = FALSE, </span></span>
<span><span class="co">##     download = FALSE, remove_command = FALSE, unzip = TRUE, remove_zip = FALSE) </span></span>
<span><span class="co">## {</span></span>
<span><span class="co">##     download_permit(data_download_acknowledgement = data_download_acknowledgement)</span></span>
<span><span class="co">##     check_for_null_parameters(mget(ls()))</span></span>
<span><span class="co">##     download_setup_dir(directory_to_download)</span></span>
<span><span class="co">##     download_setup_dir(directory_to_save)</span></span>
<span><span class="co">##     directory_to_download &lt;- download_sanitize_path(directory_to_download)</span></span>
<span><span class="co">##     directory_to_save &lt;- download_sanitize_path(directory_to_save)</span></span>
<span><span class="co">##     if (unzip == FALSE &amp;&amp; remove_zip == TRUE) {</span></span>
<span><span class="co">##         stop(paste0("Arguments unzip = FALSE and remove_zip = TRUE are not ", </span></span>
<span><span class="co">##             "acceptable together. Please change one.\n"))</span></span>
<span><span class="co">##     }</span></span>
<span><span class="co">##     date_sequence &lt;- generate_date_sequence(date_start, date_end, </span></span>
<span><span class="co">##         sub_hyphen = TRUE)</span></span>
<span><span class="co">##     base &lt;- "https://satepsanone.nesdis.noaa.gov/pub/FIRE/web/HMS/Smoke_Polygons/"</span></span>
<span><span class="co">##     commands_txt &lt;- paste0(directory_to_download, "hms_smoke_", </span></span>
<span><span class="co">##         utils::head(date_sequence, n = 1), "_", utils::tail(date_sequence, </span></span>
<span><span class="co">##             n = 1), "_curl_commands.txt")</span></span>
<span><span class="co">##     download_sink(commands_txt)</span></span>
<span><span class="co">##     download_names &lt;- NULL</span></span>
<span><span class="co">##     for (f in seq_along(date_sequence)) {</span></span>
<span><span class="co">##         year &lt;- substr(date_sequence[f], 1, 4)</span></span>
<span><span class="co">##         month &lt;- substr(date_sequence[f], 5, 6)</span></span>
<span><span class="co">##         if (data_format == "Shapefile") {</span></span>
<span><span class="co">##             suffix &lt;- ".zip"</span></span>
<span><span class="co">##             directory_to_cat &lt;- directory_to_download</span></span>
<span><span class="co">##         }</span></span>
<span><span class="co">##         else if (data_format == "KML") {</span></span>
<span><span class="co">##             suffix &lt;- ".kml"</span></span>
<span><span class="co">##             directory_to_cat &lt;- directory_to_save</span></span>
<span><span class="co">##         }</span></span>
<span><span class="co">##         url &lt;- paste0(base, data_format, "/", year, "/", month, </span></span>
<span><span class="co">##             "/hms_smoke", date_sequence[f], suffix)</span></span>
<span><span class="co">##         if (f == 1) {</span></span>
<span><span class="co">##             if (!(check_url_status(url))) {</span></span>
<span><span class="co">##                 sink()</span></span>
<span><span class="co">##                 file.remove(commands_txt)</span></span>
<span><span class="co">##                 stop(paste0("Invalid date returns HTTP code 404. ", </span></span>
<span><span class="co">##                   "Check `date_start` parameter.\n"))</span></span>
<span><span class="co">##             }</span></span>
<span><span class="co">##         }</span></span>
<span><span class="co">##         destfile &lt;- paste0(directory_to_cat, "hms_smoke_", data_format, </span></span>
<span><span class="co">##             "_", date_sequence[f], suffix)</span></span>
<span><span class="co">##         download_names &lt;- c(download_names, destfile)</span></span>
<span><span class="co">##         command &lt;- paste0("curl -s -o ", destfile, " --url ", </span></span>
<span><span class="co">##             url, "\n")</span></span>
<span><span class="co">##         cat(command)</span></span>
<span><span class="co">##     }</span></span>
<span><span class="co">##     sink()</span></span>
<span><span class="co">##     system_command &lt;- paste0(". ", commands_txt, "\n")</span></span>
<span><span class="co">##     download_run(download = download, system_command = system_command)</span></span>
<span><span class="co">##     download_remove_command(remove = remove_command, commands_txt = commands_txt)</span></span>
<span><span class="co">##     if (data_format == "KML") {</span></span>
<span><span class="co">##         return(cat(paste0("KML files cannot be unzipped.\n")))</span></span>
<span><span class="co">##     }</span></span>
<span><span class="co">##     for (d in seq_along(download_names)) {</span></span>
<span><span class="co">##         download_unzip(file_name = download_names[d], directory_to_unzip = directory_to_save, </span></span>
<span><span class="co">##             unzip = unzip)</span></span>
<span><span class="co">##     }</span></span>
<span><span class="co">##     download_remove_zips(remove = remove_zip, download_name = download_names)</span></span>
<span><span class="co">## }</span></span>
<span><span class="co">## &lt;bytecode: 0x55e79a2f3e08&gt;</span></span></code></pre>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Kyle Messier, Mitchell Manware, Insang Song, Eva Marques, Mariana Alifa Kassien, Ranadeep Daw, Daniel Zilber.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
