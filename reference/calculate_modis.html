<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Calculate MODIS product covariates in multiple CPU threads — calculate_modis • amadeus</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Calculate MODIS product covariates in multiple CPU threads — calculate_modis"><meta name="description" content="calculate_modis essentially runs calculate_modis_daily function
in each thread (subprocess). Based on daily resolution, each day's workload
will be distributed to each thread. With product argument,
the files are processed by a customized function where the unique structure
and/or characteristics of the products are considered."><meta property="og:description" content="calculate_modis essentially runs calculate_modis_daily function
in each thread (subprocess). Based on daily resolution, each day's workload
will be distributed to each thread. With product argument,
the files are processed by a customized function where the unique structure
and/or characteristics of the products are considered."><meta property="og:image" content="https://niehs.github.io/amadeus/logo.svg"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">amadeus</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.2.4.6</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><h6 class="dropdown-header" data-toc-skip>Miscellaneous</h6></li>
    <li><a class="dropdown-item" href="../articles/download_functions.html">download_data Function</a></li>
    <li><a class="dropdown-item" href="../articles/protected_datasets.html">Protected Datasets</a></li>
    <li><h6 class="dropdown-header" data-toc-skip>Source-Specific Workflows</h6></li>
    <li><a class="dropdown-item" href="../articles/terraclimate_workflow.html">Climatology Lab TerraClimate</a></li>
    <li><a class="dropdown-item" href="../articles/gridmet_workflow.html">Climatology Lab GridMET</a></li>
    <li><a class="dropdown-item" href="../articles/modis_workflow.html">NASA Moderate Resolution Imaging Spectroradiometer (MODIS)</a></li>
    <li><a class="dropdown-item" href="../articles/narr_workflow.html">NOAA North American Regional Reanalysis (NARR)</a></li>
    <li><a class="dropdown-item" href="../articles/epa_download.html">US EPA Air Quality System (AQS)</a></li>
  </ul></li>
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><a class="external-link nav-link" href="https://github.com/NIEHS/amadeus/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Calculate MODIS product covariates in multiple CPU threads</h1>
      <small class="dont-index">Source: <a href="https://github.com/NIEHS/amadeus/blob/main/R/calculate_covariates.R" class="external-link"><code>R/calculate_covariates.R</code></a></small>
      <div class="d-none name"><code>calculate_modis.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><code>calculate_modis</code> essentially runs <code><a href="calculate_modis_daily.html">calculate_modis_daily</a></code> function
in each thread (subprocess). Based on daily resolution, each day's workload
will be distributed to each thread. With <code>product</code> argument,
the files are processed by a customized function where the unique structure
and/or characteristics of the products are considered.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">calculate_modis</span><span class="op">(</span></span>
<span>  from <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  locs <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  locs_id <span class="op">=</span> <span class="st">"site_id"</span>,</span>
<span>  radius <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0L</span>, <span class="fl">1000L</span>, <span class="fl">10000L</span>, <span class="fl">50000L</span><span class="op">)</span>,</span>
<span>  preprocess <span class="op">=</span> <span class="fu">amadeus</span><span class="fu">::</span><span class="va"><a href="process_modis_merge.html">process_modis_merge</a></span>,</span>
<span>  name_covariates <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  subdataset <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  fun_summary <span class="op">=</span> <span class="st">"mean"</span>,</span>
<span>  package_list_add <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  export_list_add <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  max_cells <span class="op">=</span> <span class="fl">3e+07</span>,</span>
<span>  geom <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  scale <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-from">from<a class="anchor" aria-label="anchor" href="#arg-from"></a></dt>
<dd><p>character. List of paths to MODIS/VIIRS files.</p></dd>


<dt id="arg-locs">locs<a class="anchor" aria-label="anchor" href="#arg-locs"></a></dt>
<dd><p>sf/SpatVector object. Unique locs where covariates
will be calculated.</p></dd>


<dt id="arg-locs-id">locs_id<a class="anchor" aria-label="anchor" href="#arg-locs-id"></a></dt>
<dd><p>character(1). Site identifier. Default is <code>"site_id"</code></p></dd>


<dt id="arg-radius">radius<a class="anchor" aria-label="anchor" href="#arg-radius"></a></dt>
<dd><p>numeric. Radii to calculate covariates.
Default is <code>c(0, 1000, 10000, 50000)</code>.</p></dd>


<dt id="arg-preprocess">preprocess<a class="anchor" aria-label="anchor" href="#arg-preprocess"></a></dt>
<dd><p>function. Function to handle HDF files.</p></dd>


<dt id="arg-name-covariates">name_covariates<a class="anchor" aria-label="anchor" href="#arg-name-covariates"></a></dt>
<dd><p>character. Name header of covariates.
e.g., <code>"MOD_NDVIF_0_"</code>.
The calculated covariate names will have a form of
"<code>{name_covariates}{zero-padded buffer radius in meters}</code>",
e.g., 'MOD_NDVIF_0_50000' where 50 km radius circular buffer
was used to calculate mean NDVI value.</p></dd>


<dt id="arg-subdataset">subdataset<a class="anchor" aria-label="anchor" href="#arg-subdataset"></a></dt>
<dd><p>Indices, names, or search patterns for subdatasets.
Find detail usage of the argument in notes.</p></dd>


<dt id="arg-fun-summary">fun_summary<a class="anchor" aria-label="anchor" href="#arg-fun-summary"></a></dt>
<dd><p>character or function. Function to summarize
extracted raster values.</p></dd>


<dt id="arg-package-list-add">package_list_add<a class="anchor" aria-label="anchor" href="#arg-package-list-add"></a></dt>
<dd><p>character. A vector with package names to load
these in each thread. Note that <code>sf</code>, <code>terra</code>, <code>exactextractr</code>,
<code>doParallel</code>, <code>parallelly</code> and <code>dplyr</code> are the default packages to be
loaded.</p></dd>


<dt id="arg-export-list-add">export_list_add<a class="anchor" aria-label="anchor" href="#arg-export-list-add"></a></dt>
<dd><p>character. A vector with object names to export
to each thread. It should be minimized to spare memory.</p></dd>


<dt id="arg-max-cells">max_cells<a class="anchor" aria-label="anchor" href="#arg-max-cells"></a></dt>
<dd><p>integer(1). Maximum number of cells to be read at once.
Higher values will expedite processing, but will increase memory usage.
Maximum possible value is <code>2^31 - 1</code>.
See <code><a href="https://isciences.gitlab.io/exactextractr/reference/exact_extract.html" class="external-link">exactextractr::exact_extract</a></code> for details.</p></dd>


<dt id="arg-geom">geom<a class="anchor" aria-label="anchor" href="#arg-geom"></a></dt>
<dd><p>FALSE/"sf"/"terra".. Should the function return with geometry?
Default is <code>FALSE</code>, options with geometry are "sf" or "terra". The
coordinate reference system of the <code>sf</code> or <code>SpatVector</code> is that of <code>from.</code></p></dd>


<dt id="arg-scale">scale<a class="anchor" aria-label="anchor" href="#arg-scale"></a></dt>
<dd><p>character(1). Scale expression to be applied to the raw values.
It is crucial that users review the technical documentatio of the MODIS product
they are using to ensure proper scale.
An example for the MOD11A1 product's LST_Day_1km variable (land surface temperature)
would be <code>scale = "* 0.02"</code>.
Default is <code>NULL</code>, which applies no scale.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Arguments passed to <code>preprocess</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A data.frame or SpatVector with an attribute:</p><ul><li><p><code>attr(., "dates_dropped")</code>: Dates with insufficient tiles.
Note that the dates mean the dates with insufficient tiles,
not the dates without available tiles.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="note">Note<a class="anchor" aria-label="anchor" href="#note"></a></h2>
    <p>Overall, this function and dependent routines assume that the file
system can handle concurrent access to the (network) disk by multiple
processes. File system characteristics, package versions, and hardware
settings and specification can affect the processing efficiency.
<code>locs</code> is expected to be convertible to <code>sf</code> object. <code>sf</code>, <code>SpatVector</code>, and
other class objects that could be converted to <code>sf</code> can be used.
Common arguments in <code>preprocess</code> functions such as <code>date</code> and <code>path</code> are
automatically detected and passed to the function. Please note that
<code>locs</code> here and <code>path</code> in <code>preprocess</code> functions are assumed to have a
standard naming convention of raw files from NASA.
The argument <code>subdataset</code> should be in a proper format
depending on <code>preprocess</code> function:</p><ul><li><p><code><a href="process_modis_merge.html">process_modis_merge()</a></code>: Regular expression pattern.
e.g., <code>"^LST_"</code></p></li>
<li><p><code><a href="process_modis_swath.html">process_modis_swath()</a></code>: Subdataset names.
e.g., <code>c("Cloud_Fraction_Day", "Cloud_Fraction_Night")</code></p></li>
<li><p><code><a href="process_blackmarble.html">process_blackmarble()</a></code>: Subdataset number.
e.g., for VNP46A2 product, 3L.
Dates with less than 80 percent of the expected number of tiles,
which are determined by the mode of the number of tiles, are removed.
Users will be informed of the dates with insufficient tiles.
The result data.frame will have an attribute with the dates with
insufficient tiles.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>This function leverages the calculation of single-day MODIS
covariates:</p><ul><li><p><code><a href="calculate_modis_daily.html">calculate_modis_daily()</a></code></p></li>
</ul><p>Also, for preprocessing, please refer to:</p><ul><li><p><code><a href="process_modis_merge.html">process_modis_merge()</a></code></p></li>
<li><p><code><a href="process_modis_swath.html">process_modis_swath()</a></code></p></li>
<li><p><code><a href="process_blackmarble.html">process_blackmarble()</a></code></p></li>
</ul></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co">## NOTE: Example is wrapped in `\dontrun{}` as function requires a large</span></span></span>
<span class="r-in"><span><span class="co">##       amount of data which is not included in the package.</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="va">locs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>lon <span class="op">=</span> <span class="op">-</span><span class="fl">78.8277</span>, lat <span class="op">=</span> <span class="fl">35.95013</span>, id <span class="op">=</span> <span class="st">"001"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">locs</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/vect.html" class="external-link">vect</a></span><span class="op">(</span><span class="va">locs</span>, geom <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"lon"</span>, <span class="st">"lat"</span><span class="op">)</span>, crs <span class="op">=</span> <span class="st">"EPSG:4326"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">calculate_modis</span><span class="op">(</span></span></span>
<span class="r-in"><span>  from <span class="op">=</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="st">"./data"</span>, pattern <span class="op">=</span> <span class="st">"VNP46A2."</span>, full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  locs <span class="op">=</span> <span class="va">locs</span>,</span></span>
<span class="r-in"><span>  locs_id <span class="op">=</span> <span class="st">"site_id"</span>,</span></span>
<span class="r-in"><span>  radius <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0L</span>, <span class="fl">1000L</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  preprocess <span class="op">=</span> <span class="va">process_modis_merge</span>,</span></span>
<span class="r-in"><span>  name_covariates <span class="op">=</span> <span class="st">"cloud_fraction_0"</span>,</span></span>
<span class="r-in"><span>  subdataset <span class="op">=</span> <span class="st">"Cloud_Fraction"</span>,</span></span>
<span class="r-in"><span>  fun_summary <span class="op">=</span> <span class="st">"mean"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Mitchell Manware, Insang Song, Eva Marques, Mariana Alifa Kassien, Kyle Messier.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

